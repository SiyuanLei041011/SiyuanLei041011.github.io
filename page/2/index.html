<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="SiyuanLei&#39;s Blog">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="SiyuanLei&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="SiyuanLei">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/2/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SiyuanLei's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">SiyuanLei's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="SiyuanLei"
      src="/images/femboy.jpg">
  <p class="site-author-name" itemprop="name">SiyuanLei</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/SiyuanLei041011" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;SiyuanLei041011" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:SiyuanLei041011@gmail.com" title="E-Mail → mailto:SiyuanLei041011@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/Esther041011" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;Esther041011" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://arxiv.org/" title="https:&#x2F;&#x2F;arxiv.org&#x2F;" rel="noopener" target="_blank">Arxiv</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://libgen.onl/library-genesis/" title="https:&#x2F;&#x2F;libgen.onl&#x2F;library-genesis&#x2F;" rel="noopener" target="_blank">LibGen</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://down.wlwkw.cn:8888/" title="http:&#x2F;&#x2F;down.wlwkw.cn:8888&#x2F;" rel="noopener" target="_blank">EBook</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/04/Verilog%E7%AC%AC%E5%9B%9B%E7%AB%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/femboy.jpg">
      <meta itemprop="name" content="SiyuanLei">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SiyuanLei's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | SiyuanLei's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/05/04/Verilog%E7%AC%AC%E5%9B%9B%E7%AB%A0/" class="post-title-link" itemprop="url">第四章:Verilog HDL数字逻辑电路设计方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-05-04 00:00:00" itemprop="dateCreated datePublished" datetime="2025-05-04T00:00:00+08:00">2025-05-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-06-30 20:40:19" itemprop="dateModified" datetime="2025-06-30T20:40:19+08:00">2025-06-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/EE/" itemprop="url" rel="index"><span itemprop="name">EE</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/EE/%E6%95%B0%E5%AD%97%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">数字设计</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/EE/%E6%95%B0%E5%AD%97%E8%AE%BE%E8%AE%A1/Verilog/" itemprop="url" rel="index"><span itemprop="name">Verilog</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="组合电路的设计">组合电路的设计</h2>
<p>例子：设计一个举重裁判电路，有A，B，C三个裁判，只有当两个及以上通过，才算通过。</p>
<p>先列出真值表，然后写出逻辑代数，然后利用卡诺图化简</p>
<p>真值表如下</p>
<table>
<thead>
<tr>
<th style="text-align: center;">A</th>
<th style="text-align: center;">B</th>
<th style="text-align: center;">C</th>
<th style="text-align: center;">OUT</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<p>对应的卡诺图如下</p>
<table>
<thead>
<tr>
<th style="text-align: center;">C</th>
<th style="text-align: center;">00</th>
<th style="text-align: center;">01</th>
<th style="text-align: center;">10</th>
<th style="text-align: center;">11</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>0</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;"><em>1</em></td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;"><strong>1</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;"><em>1</em></td>
<td style="text-align: center;"><em>1</em></td>
<td style="text-align: center;"><em>1</em></td>
</tr>
</tbody>
</table>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> design1 (A,B,C,OUT);</span><br><span class="line">    <span class="keyword">input</span>  A,B,C;</span><br><span class="line">    <span class="keyword">output</span> OUT;</span><br><span class="line">    <span class="keyword">assign</span> OUT=(A&amp;B)|(B&amp;C)|(C&amp;A);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> design2 (A,B,C,OUT);</span><br><span class="line">    <span class="keyword">input</span>  A,B,C;</span><br><span class="line">    <span class="keyword">output</span> OUT;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">1</span>:<span class="number">0</span>]sum;</span><br><span class="line">    <span class="keyword">reg</span> OUT;</span><br><span class="line">    <span class="keyword">assign</span> sum=A+B+C;</span><br><span class="line">    <span class="keyword">always</span> @(sum)</span><br><span class="line">        <span class="keyword">if</span>(sum&gt;<span class="number">1</span>) OUT=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span>      OUT=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="加法器">加法器</h3>
<p>真值表如下:</p>
<p>C_IN是前一位的进位,C_OUT是进位.</p>
<table>
<thead>
<tr>
<th style="text-align: center;">A</th>
<th style="text-align: center;">B</th>
<th style="text-align: center;">C_IN</th>
<th style="text-align: center;">SUM</th>
<th style="text-align: center;">C_OUT</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<p>由此可知</p>
<p>$ SUM=ABC_IN $ $ C_OUT=AB+(AB)C_IN $</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> one_bit_fulladder(A,B,C_IN,SUM,C_OUT)</span><br><span class="line">    <span class="keyword">input</span>   A,B,C_IN;</span><br><span class="line">    <span class="keyword">output</span>  SUM,C_OUT;</span><br><span class="line">        <span class="keyword">assign</span> SUM=(A^B)^C_IN;</span><br><span class="line">        <span class="keyword">assign</span> C_OUT=(A&amp;B)|((A^B)&amp;C_IN);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>另外一种行为级建模:</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> one_bit_fulladder(A,B,C_IN,SUM,C_OUT)</span><br><span class="line">    <span class="keyword">input</span>   A,B,C_IN;</span><br><span class="line">    <span class="keyword">output</span>  SUM,C_OUT;</span><br><span class="line">        <span class="keyword">assign</span> &#123;C_OUT,SUM&#125;=A+B+C_IN;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>事实上,这种行为级建模可以推广到高位全加器,只需要改变位宽即可:</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> eight_bit_fulladder(A,B,C_IN,SUM,C_OUT)</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">7</span>:<span class="number">0</span>]   A,B;</span><br><span class="line">    <span class="keyword">input</span>          C_IN;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>]   SUM;</span><br><span class="line">    <span class="keyword">output</span>         C_OUT;</span><br><span class="line">        <span class="keyword">assign</span> &#123;C_OUT,SUM&#125;=A+B+C_IN;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="数据比较器">数据比较器</h3>
<p>先来看4位数据比较器的真值表</p>
<table style="width:100%;">
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th style="text-align: center;"><span
class="math inline">\(A_3~B_3\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(A_2~B_2\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(A_1~B_1\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(A_0~B_0\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(C_{A&gt;B}\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(C_{A=B}\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(C_{A&lt;B}\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(F_{A&gt;B}\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(F_{A=B}\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(F_{A&lt;B}\)</span></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><span
class="math inline">\(A_3&gt;B_3\)</span></td>
<td style="text-align: center;">x x</td>
<td style="text-align: center;">x x</td>
<td style="text-align: center;">x x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(A_3&lt;B_3\)</span></td>
<td style="text-align: center;">x x</td>
<td style="text-align: center;">x x</td>
<td style="text-align: center;">x x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(A_3=B_3\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(A_2&gt;B_2\)</span></td>
<td style="text-align: center;">x x</td>
<td style="text-align: center;">x x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(A_3=B_3\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(A_2&lt;B_2\)</span></td>
<td style="text-align: center;">x x</td>
<td style="text-align: center;">x x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(A_3=B_3\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(A_2=B_2\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(A_1&gt;B_1\)</span></td>
<td style="text-align: center;">x x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(A_3=B_3\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(A_2=B_2\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(A_1&lt;B_1\)</span></td>
<td style="text-align: center;">x x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(A_3=B_3\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(A_2=B_2\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(A_1=B_1\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(A_0&gt;B_0\)</span></td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(A_3=B_3\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(A_2=B_2\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(A_1=B_1\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(A_0&lt;B_0\)</span></td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(A_3=B_3\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(A_2=B_2\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(A_1=B_1\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(A_0=B_0\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(C_{A&gt;B}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(C_{A=B}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(C_{A&lt;B}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(C_{A&gt;B}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(C_{A=B}\)</span></td>
<td style="text-align: center;"><span
class="math inline">\(C_{A&lt;B}\)</span></td>
</tr>
</tbody>
</table>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> four_bit_comp1 (A,B,C,F);</span><br><span class="line">    <span class="keyword">parameter</span>   width=<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">input</span>       [width-<span class="number">1</span>:<span class="number">0</span>]     A;</span><br><span class="line">    <span class="keyword">input</span>       [width-<span class="number">1</span>:<span class="number">0</span>]     B;<span class="comment">//输入两个4bit二进制数字</span></span><br><span class="line">    <span class="keyword">input</span>       [<span class="number">2</span>:<span class="number">0</span>]           C;<span class="comment">//前一级的比较结果</span></span><br><span class="line">    <span class="keyword">output</span>      [<span class="number">2</span>:<span class="number">0</span>]           F;</span><br><span class="line">    <span class="keyword">reg</span>         [<span class="number">2</span>:<span class="number">0</span>]           F;</span><br><span class="line">    <span class="keyword">always</span> @(A <span class="keyword">or</span> B <span class="keyword">or</span> C) </span><br><span class="line">        <span class="keyword">if</span>(A&gt;B)                 F=<span class="number">3&#x27;b100</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(A&lt;B)            F=<span class="number">3&#x27;b001</span>;</span><br><span class="line">        <span class="keyword">else</span>                    F=C;</span><br><span class="line"><span class="keyword">endmodule</span><span class="comment">//四位数据比较器</span></span><br></pre></td></tr></table></figure>
<h3 id="数据选择器">数据选择器</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> mux8to1 (data,sel,out);</span><br><span class="line"><span class="keyword">input</span>  [<span class="number">7</span>:<span class="number">0</span>]    data;</span><br><span class="line"><span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>]    sel;</span><br><span class="line"><span class="keyword">output</span>          out;</span><br><span class="line"><span class="keyword">reg</span>             out;</span><br><span class="line"><span class="keyword">always</span> @(data,sel)</span><br><span class="line"><span class="keyword">case</span> (sel)</span><br><span class="line">    <span class="number">3&#x27;b000</span>:out&lt;=data[<span class="number">0</span>];</span><br><span class="line">    <span class="number">3&#x27;b001</span>:out&lt;=data[<span class="number">1</span>];</span><br><span class="line">    <span class="number">3&#x27;b010</span>:out&lt;=data[<span class="number">2</span>];</span><br><span class="line">    <span class="number">3&#x27;b011</span>:out&lt;=data[<span class="number">3</span>];</span><br><span class="line">    <span class="number">3&#x27;b100</span>:out&lt;=data[<span class="number">4</span>];</span><br><span class="line">    <span class="number">3&#x27;b101</span>:out&lt;=data[<span class="number">5</span>];</span><br><span class="line">    <span class="number">3&#x27;b110</span>:out&lt;=data[<span class="number">6</span>];</span><br><span class="line">    <span class="number">3&#x27;b111</span>:out&lt;=data[<span class="number">7</span>];</span><br><span class="line"><span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">endmodule</span><span class="comment">//八选一数据选择器</span></span><br></pre></td></tr></table></figure>
<h3 id="数字编码器">数字编码器</h3>
<p>3位二进制8线-3线编码器真值表</p>
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr>
<th style="text-align: center;"><span
class="math inline">\(I_0\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(I_1\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(I_2\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(I_3\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(I_4\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(I_5\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(I_6\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(I_7\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(F_2\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(F_1\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(F_0\)</span></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> code8to3 (F,I);</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">7</span>:<span class="number">0</span>]    I;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>]    F;</span><br><span class="line">    <span class="keyword">reg</span>    [<span class="number">3</span>:<span class="number">0</span>]    F;</span><br><span class="line">    <span class="keyword">always</span> @(I) </span><br><span class="line">        <span class="keyword">case</span> (I)</span><br><span class="line">            <span class="number">8&#x27;b00000001</span>:F=<span class="number">3&#x27;b000</span>; </span><br><span class="line">            <span class="number">8&#x27;b00000010</span>:F=<span class="number">3&#x27;b001</span>; </span><br><span class="line">            <span class="number">8&#x27;b00000100</span>:F=<span class="number">3&#x27;b010</span>; </span><br><span class="line">            <span class="number">8&#x27;b00001000</span>:F=<span class="number">3&#x27;b011</span>; </span><br><span class="line">            <span class="number">8&#x27;b00010000</span>:F=<span class="number">3&#x27;b100</span>; </span><br><span class="line">            <span class="number">8&#x27;b00100000</span>:F=<span class="number">3&#x27;b101</span>; </span><br><span class="line">            <span class="number">8&#x27;b01000000</span>:F=<span class="number">3&#x27;b110</span>; </span><br><span class="line">            <span class="number">8&#x27;b10000000</span>:F=<span class="number">3&#x27;b111</span>; </span><br><span class="line">            <span class="keyword">default</span>:F=<span class="number">3&#x27;bx</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">endmodule</span><span class="comment">//8线-3线编码器</span></span><br></pre></td></tr></table></figure>
<p>8线-3线优先编码器真值表</p>
<table style="width:100%;">
<colgroup>
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr>
<th style="text-align: center;"><span
class="math inline">\(\overline{S}\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{I}_0\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{I}_1\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{I}_2\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{I}_3\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{I}_4\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{I}_5\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{I}_6\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{I}_7\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{Y}_2\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{Y}_1\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{Y}_0\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{Y}_s\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{Y}_{ex}\)</span></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<p>说明:</p>
<ol type="1">
<li><span
class="math inline">\(\overline{S}=1\)</span>时,电路处于禁止工作状态,此时无论是什么输入,输出总为高电平.</li>
<li><span class="math inline">\(\overline{S}=0\)</span>时,电路工作,<span
class="math inline">\(\overline{I}_7\)</span>优先级最高,<span
class="math inline">\(\overline{I}_0\)</span>优先级最低.当<span
class="math inline">\(\overline{I}_7=0\)</span>时,无论其他输入端为何值,输出总为<span
class="math inline">\(\overline{Y}_2\overline{Y}_1\overline{Y}_0=000\)</span>,其他状态以此类推.</li>
<li>对于<span
class="math inline">\(\overline{Y}_2\overline{Y}_1\overline{Y}_0=111\)</span>,有三种状态,若<span
class="math inline">\(\overline{Y}_s\overline{Y}_{ex}=10\)</span>,则表示电路工作且<span
class="math inline">\(\overline{I}_0\)</span>有编码信号输入;若<span
class="math inline">\(\overline{Y}_s\overline{Y}_{ex}=01\)</span>,则表示电路工作且没有编码信号输入;若<span
class="math inline">\(\overline{Y}_s\overline{Y}_{ex}=11\)</span>,则表示电路不工作.</li>
</ol>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> mux8to3_p(data_out,Ys,Yex,sel,data_in);</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">2</span>:<span class="number">0</span>]     data_out;</span><br><span class="line">    <span class="keyword">output</span>           Ys,Yex;</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">7</span>:<span class="number">0</span>]     data_in;</span><br><span class="line">    <span class="keyword">input</span>            sel;</span><br><span class="line">    <span class="keyword">reg</span>    [<span class="number">2</span>:<span class="number">0</span>]     data_out;</span><br><span class="line">    <span class="keyword">reg</span>              Ys,Yex;</span><br><span class="line">        <span class="keyword">always</span>@(data_in <span class="keyword">or</span> sel)</span><br><span class="line">            <span class="keyword">if</span>(sel) &#123;data_out,Ys,Yex&#125;=&#123;<span class="number">3&#x27;b111</span>,<span class="number">1&#x27;b1</span>,<span class="number">1&#x27;b1</span>&#125;;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">casex</span> (data_in)</span><br><span class="line">                        <span class="number">8&#x27;b0</span>???????:&#123;data_out,Ys,Yex&#125;=&#123;<span class="number">3&#x27;b000</span>,<span class="number">1&#x27;b1</span>,<span class="number">1&#x27;b0</span>&#125;;</span><br><span class="line">                        <span class="number">8&#x27;b10</span>??????:&#123;data_out,Ys,Yex&#125;=&#123;<span class="number">3&#x27;b001</span>,<span class="number">1&#x27;b1</span>,<span class="number">1&#x27;b0</span>&#125;;</span><br><span class="line">                        <span class="number">8&#x27;b110</span>?????:&#123;data_out,Ys,Yex&#125;=&#123;<span class="number">3&#x27;b010</span>,<span class="number">1&#x27;b1</span>,<span class="number">1&#x27;b0</span>&#125;;</span><br><span class="line">                        <span class="number">8&#x27;b1110</span>????:&#123;data_out,Ys,Yex&#125;=&#123;<span class="number">3&#x27;b011</span>,<span class="number">1&#x27;b1</span>,<span class="number">1&#x27;b0</span>&#125;;</span><br><span class="line">                        <span class="number">8&#x27;b11110</span>???:&#123;data_out,Ys,Yex&#125;=&#123;<span class="number">3&#x27;b100</span>,<span class="number">1&#x27;b1</span>,<span class="number">1&#x27;b0</span>&#125;;</span><br><span class="line">                        <span class="number">8&#x27;b111110</span>??:&#123;data_out,Ys,Yex&#125;=&#123;<span class="number">3&#x27;b101</span>,<span class="number">1&#x27;b1</span>,<span class="number">1&#x27;b0</span>&#125;;</span><br><span class="line">                        <span class="number">8&#x27;b1111110</span>?:&#123;data_out,Ys,Yex&#125;=&#123;<span class="number">3&#x27;b110</span>,<span class="number">1&#x27;b1</span>,<span class="number">1&#x27;b0</span>&#125;;</span><br><span class="line">                        <span class="number">8&#x27;b11111110</span>:&#123;data_out,Ys,Yex&#125;=&#123;<span class="number">3&#x27;b111</span>,<span class="number">1&#x27;b1</span>,<span class="number">1&#x27;b0</span>&#125;;</span><br><span class="line">                        <span class="number">8&#x27;b11111111</span>:&#123;data_out,Ys,Yex&#125;=&#123;<span class="number">3&#x27;b111</span>,<span class="number">1&#x27;b0</span>,<span class="number">1&#x27;b1</span>&#125;;</span><br><span class="line">                    <span class="keyword">endcase</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>二进制转十进制的8421BCD编码器的真值表如下</p>
<table>
<thead>
<tr>
<th style="text-align: center;">十进制数</th>
<th style="text-align: center;">D</th>
<th style="text-align: center;">C</th>
<th style="text-align: center;">B</th>
<th style="text-align: center;">A</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><span
class="math inline">\(0(Y_0)\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(1(Y_1)\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(2(Y_2)\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(3(Y_3)\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(4(Y_4)\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(5(Y_5)\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(6(Y_6)\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(7(Y_7)\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(8(Y_8)\)</span></td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: center;"><span
class="math inline">\(9(Y_9)\)</span></td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> BCD8421(data_out,data_in);</span><br><span class="line">    <span class="keyword">output</span>  [<span class="number">3</span>:<span class="number">0</span>]   data_out;</span><br><span class="line">    <span class="keyword">input</span>   [<span class="number">8</span>:<span class="number">0</span>]   data_in;</span><br><span class="line">    <span class="keyword">reg</span>     [<span class="number">3</span>:<span class="number">0</span>]   data_out;</span><br><span class="line">        <span class="keyword">always</span>@(data_in)</span><br><span class="line">            <span class="keyword">case</span>(data_in)</span><br><span class="line">                <span class="number">9&#x27;b000000000</span>:data_out=<span class="number">4&#x27;b0000</span>;</span><br><span class="line">                <span class="number">9&#x27;b000000001</span>:data_out=<span class="number">4&#x27;b0001</span>;</span><br><span class="line">                <span class="number">9&#x27;b000000010</span>:data_out=<span class="number">4&#x27;b0010</span>;</span><br><span class="line">                <span class="number">9&#x27;b000000100</span>:data_out=<span class="number">4&#x27;b0011</span>;</span><br><span class="line">                <span class="number">9&#x27;b000001000</span>:data_out=<span class="number">4&#x27;b0100</span>;</span><br><span class="line">                <span class="number">9&#x27;b000010000</span>:data_out=<span class="number">4&#x27;b0101</span>;</span><br><span class="line">                <span class="number">9&#x27;b000100000</span>:data_out=<span class="number">4&#x27;b0110</span>;</span><br><span class="line">                <span class="number">9&#x27;b001000000</span>:data_out=<span class="number">4&#x27;b0111</span>;</span><br><span class="line">                <span class="number">9&#x27;b010000000</span>:data_out=<span class="number">4&#x27;b1000</span>;</span><br><span class="line">                <span class="number">9&#x27;b100000000</span>:data_out=<span class="number">4&#x27;b1001</span>;</span><br><span class="line">                <span class="keyword">default</span>     :data_out=<span class="number">4&#x27;b0000</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="数字译码器">数字译码器</h3>
<p>2线-4线译码器的真值表如下</p>
<table style="width:100%;">
<colgroup>
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th style="text-align: center;"><span
class="math inline">\(E\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(A_1\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(A_0\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{Y}_0\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{Y}_1\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{Y}_2\)</span></th>
<th style="text-align: center;"><span
class="math inline">\(\overline{Y}_3\)</span></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">x</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p>说明:</p>
<ol type="1">
<li><span class="math inline">\(N\)</span>位二进制译码器有<span
class="math inline">\(N\)</span>个输入,<span
class="math inline">\(2^N\)</span>个输出.<span
class="math inline">\(E\)</span>为使能端,<span
class="math inline">\(E=1\)</span>时禁止工作,<span
class="math inline">\(E=0\)</span>时正常工作.</li>
<li>输出函数可以写为<span
class="math inline">\(\overline{Y}_i=\overline{\overline{E}m_i}\)</span>,其中<span
class="math inline">\(m_i\)</span>表示输入地址变量的一个最小项.</li>
</ol>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> decode_2to4(Y,E,A);</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] Y;</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] A;</span><br><span class="line">    <span class="keyword">input</span>        E;</span><br><span class="line">    <span class="keyword">reg</span>    [<span class="number">3</span>:<span class="number">0</span>] Y;</span><br><span class="line">        <span class="keyword">always</span>@(E <span class="keyword">or</span> A)</span><br><span class="line">            <span class="keyword">case</span>(&#123;E,A&#125;)</span><br><span class="line">                <span class="number">3&#x27;b1</span>?? :Y=<span class="number">4&#x27;b0000</span>;</span><br><span class="line">                <span class="number">3&#x27;b000</span> :Y=<span class="number">4&#x27;b0001</span>;</span><br><span class="line">                <span class="number">3&#x27;b001</span> :Y=<span class="number">4&#x27;b0010</span>;</span><br><span class="line">                <span class="number">3&#x27;b010</span> :Y=<span class="number">4&#x27;b0100</span>;</span><br><span class="line">                <span class="number">3&#x27;b011</span> :Y=<span class="number">4&#x27;b1000</span>;</span><br><span class="line">                <span class="keyword">default</span>:Y=<span class="number">4&#x27;b0000</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="时序电路的设计">时序电路的设计</h2>
<h3 id="触发器">触发器</h3>
<p>触发器是时序逻辑的最基本电路单元.根据功能的不同,触发器还可以有置位,复位,使能,选择等功能.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> DFF(q,clk,data_in)</span><br><span class="line">    <span class="keyword">output</span> q;</span><br><span class="line">    <span class="keyword">input</span>  clk,data_in;</span><br><span class="line">    <span class="keyword">reg</span>    q;</span><br><span class="line">        <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk) q&lt;=data_in;</span><br><span class="line"><span class="keyword">endmodule</span><span class="comment">//最简单的D触发器</span></span><br></pre></td></tr></table></figure>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> DFF(q,clk,reset,data_in)</span><br><span class="line">    <span class="keyword">output</span> q;</span><br><span class="line">    <span class="keyword">input</span>  clk,reset,data_in;</span><br><span class="line">    <span class="keyword">reg</span>    q;</span><br><span class="line">        <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk);</span><br><span class="line">            <span class="keyword">if</span>(!reset) q&lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span>       q&lt;=data_in;</span><br><span class="line"><span class="keyword">endmodule</span><span class="comment">//同步清零的D触发器</span></span><br></pre></td></tr></table></figure>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> DFF(q,clk,reset,data_in)</span><br><span class="line">    <span class="keyword">output</span> q;</span><br><span class="line">    <span class="keyword">input</span>  clk,reset,data_in;</span><br><span class="line">    <span class="keyword">reg</span>    q;</span><br><span class="line">        <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> reset);</span><br><span class="line">            <span class="keyword">if</span>(!reset) q&lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span>       q&lt;=data_in;</span><br><span class="line"><span class="keyword">endmodule</span><span class="comment">//异步清零的D触发器</span></span><br></pre></td></tr></table></figure>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> DFF (q,clk,rst1,rst2,in);</span><br><span class="line">    <span class="keyword">input</span>  clk,rst1,rst2,in;</span><br><span class="line">    <span class="keyword">output</span> q;</span><br><span class="line">    <span class="keyword">reg</span>    q;</span><br><span class="line">        <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) </span><br><span class="line">            <span class="keyword">if</span>(!rst1) q&lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span>      q&lt;=in;</span><br><span class="line">        <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst2)</span><br><span class="line">            <span class="keyword">if</span>(!rst2) q&lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span>      q&lt;=in;</span><br><span class="line"><span class="keyword">endmodule</span><span class="comment">//具有同步和异步清零的D触发器</span></span><br></pre></td></tr></table></figure>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> TFF (T,clk,rst,out);</span><br><span class="line">    <span class="keyword">input</span>  T,clk,rst;</span><br><span class="line">    <span class="keyword">output</span> out;</span><br><span class="line">    <span class="keyword">reg</span> out;</span><br><span class="line">        <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst)</span><br><span class="line">            <span class="keyword">if</span>(!rst)    out&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(T)  out&lt;=~out;</span><br><span class="line"><span class="keyword">endmodule</span><span class="comment">//T触发器</span></span><br></pre></td></tr></table></figure>
<h3 id="计数器">计数器</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> comp2bit(Q,clk,reset)</span><br><span class="line">    <span class="keyword">output</span>  Q;</span><br><span class="line">    <span class="keyword">input</span>   clk,reset;</span><br><span class="line">    <span class="keyword">reg</span>     Q;</span><br><span class="line">        <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line">            <span class="keyword">if</span>(!reset)  Q&lt;=<span class="number">1&#x27;b0</span>;</span><br><span class="line">            <span class="keyword">else</span>        Q&lt;=~Q;</span><br><span class="line"><span class="keyword">endmodule</span><span class="comment">//二进制计数器</span></span><br></pre></td></tr></table></figure>
<p>对于<span
class="math inline">\(M\)</span>进制的计数器,首先应该确定计数器所需触发器的个数.<span
class="math inline">\(N\)</span>个触发器对应了<span
class="math inline">\(2^N\)</span>个状态,所以应该有<span
class="math inline">\(2^N&gt;M\)</span>.例如,下面的十一进制计数器最少需要<span
class="math inline">\(4\)</span>个触发器.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> counter (clk,rst,count);</span><br><span class="line">    <span class="keyword">input</span>           clk,rst;</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>]    count;</span><br><span class="line">    <span class="keyword">reg</span>    [<span class="number">3</span>:<span class="number">0</span>]    count;</span><br><span class="line">        <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)</span><br><span class="line">            <span class="keyword">if</span>(rst)                 count&lt;=<span class="number">4&#x27;b0000</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(count==<span class="number">4&#x27;b1010</span>) count&lt;=<span class="number">4&#x27;b0000</span>;</span><br><span class="line">            <span class="keyword">else</span>                    count&lt;=count+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">endmodule</span><span class="comment">//11进制计数器，在此基础上可以修改成任意进制计数器</span></span><br></pre></td></tr></table></figure>
<h3 id="移位寄存器">移位寄存器</h3>
<p><span class="math inline">\(N\)</span>位环形移位寄存器由<span
class="math inline">\(N\)</span>个寄存器组成,将每个寄存器的输出作为下一个寄存器的输入,并将高位寄存器的输出作为循环的输入.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> shiftregist (D,clk,rst);</span><br><span class="line">    <span class="keyword">parameter</span> width=<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">input</span>               clk,rst;</span><br><span class="line">    <span class="keyword">output</span> [width-<span class="number">1</span>:<span class="number">0</span>]  D;</span><br><span class="line">    <span class="keyword">reg</span>    [width-<span class="number">1</span>:<span class="number">0</span>]  D;</span><br><span class="line">        <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) </span><br><span class="line">            <span class="keyword">if</span>(!rst) D&lt;=<span class="number">4&#x27;b0000</span>;</span><br><span class="line">            <span class="keyword">else</span>     D&lt;=&#123;D[width-<span class="number">2</span>:<span class="number">0</span>],D[width-<span class="number">1</span>]&#125;;<span class="comment">//把第一位搬到最后一位，第一位之后的位整体前移一位</span></span><br><span class="line"><span class="keyword">endmodule</span><span class="comment">//环形移位寄存器</span></span><br></pre></td></tr></table></figure>
<h3 id="序列信号发生器">序列信号发生器</h3>
<p>序列信号发生器按照循环长度<span
class="math inline">\(M\)</span>与触发器数目<span
class="math inline">\(n\)</span>的关系可以分成三种:</p>
<ol type="1">
<li>最大循环长度序列码,<span class="math inline">\(M=2^n\)</span></li>
<li>最长线性序列码(<span class="math inline">\(M\)</span>序列码),<span
class="math inline">\(M=2^n-1\)</span></li>
<li>任意循环长度序列码,<span
class="math inline">\(M&lt;2^n\)</span></li>
</ol>
<p>序列信号发生器可以由纯时序逻辑电路构成,也可以由时序和组合逻辑电路组成.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> signal_maker (out,clk,load,D);</span><br><span class="line">    <span class="keyword">parameter</span> M=<span class="number">6</span>;</span><br><span class="line">    <span class="keyword">input</span>               clk,load;</span><br><span class="line">    <span class="keyword">input</span>  [M-<span class="number">1</span>:<span class="number">0</span>]      D;</span><br><span class="line">    <span class="keyword">output</span>              out;</span><br><span class="line">    <span class="keyword">reg</span>    [M-<span class="number">1</span>:<span class="number">0</span>]      Q;</span><br><span class="line">        <span class="keyword">initial</span> Q=<span class="number">6&#x27;b100111</span>;</span><br><span class="line">            <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)</span><br><span class="line">                <span class="keyword">if</span>(load) Q&lt;=D;</span><br><span class="line">                <span class="keyword">else</span>     Q&lt;=&#123;Q[M-<span class="number">2</span>:<span class="number">0</span>],Q[M-<span class="number">1</span>]&#125;;<span class="comment">//把第一位搬到最后一位，第一位之后的位整体前移一位</span></span><br><span class="line">        <span class="keyword">assign</span> out=Q[M-<span class="number">1</span>];</span><br><span class="line"><span class="keyword">endmodule</span><span class="comment">//这是一个产生100111序列的信号发生器，由时序逻辑组成</span></span><br></pre></td></tr></table></figure>
<p>下面利用时序和组合逻辑电路设计序列信号发生器,设计步骤如下:</p>
<ol type="1">
<li>根据给定的序列信号循环周期<span
class="math inline">\(M\)</span>,确定移位寄存器的个数<span
class="math inline">\(n\)</span>,<span
class="math inline">\(2^{n-1}&lt;M\leq 2^n\)</span></li>
<li>确定移位寄存器的<span
class="math inline">\(M\)</span>个独立状态,将给定的序列码按照移位规律每<span
class="math inline">\(n\)</span>位一组,划分为<span
class="math inline">\(M\)</span>个状态.若<span
class="math inline">\(M\)</span>个状态里出现重复现象,则应该增加移位寄存器的个数.用<span
class="math inline">\(n+1\)</span>位重复上述过程,直至划分为<span
class="math inline">\(M\)</span>个独立状态.</li>
<li>根据<span
class="math inline">\(M\)</span>个不同的状态列出移位寄存器的态序表和反馈函数表,求出反馈函数<span
class="math inline">\(F\)</span>的表达式</li>
<li>检查自启动功能</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/04/%E6%9D%82%E8%B4%A8%E5%8D%8A%E5%AF%BC%E4%BD%93%E7%9A%84%E8%BD%BD%E6%B5%81%E5%AD%90%E6%B5%93%E5%BA%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/femboy.jpg">
      <meta itemprop="name" content="SiyuanLei">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SiyuanLei's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | SiyuanLei's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/05/04/%E6%9D%82%E8%B4%A8%E5%8D%8A%E5%AF%BC%E4%BD%93%E7%9A%84%E8%BD%BD%E6%B5%81%E5%AD%90%E6%B5%93%E5%BA%A6/" class="post-title-link" itemprop="url">杂质半导体的载流子浓度</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-05-04 00:00:00" itemprop="dateCreated datePublished" datetime="2025-05-04T00:00:00+08:00">2025-05-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-05-27 14:35:27" itemprop="dateModified" datetime="2025-05-27T14:35:27+08:00">2025-05-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/EE/" itemprop="url" rel="index"><span itemprop="name">EE</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/EE/%E5%8D%8A%E5%AF%BC%E4%BD%93%E7%89%A9%E7%90%86%E4%B8%8E%E5%99%A8%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">半导体物理与器件</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/04/%E8%B4%B9%E6%9B%BC%E5%9B%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/femboy.jpg">
      <meta itemprop="name" content="SiyuanLei">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SiyuanLei's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | SiyuanLei's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/05/04/%E8%B4%B9%E6%9B%BC%E5%9B%BE/" class="post-title-link" itemprop="url">Phy</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-05-04 00:00:00" itemprop="dateCreated datePublished" datetime="2025-05-04T00:00:00+08:00">2025-05-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-05-12 22:14:58" itemprop="dateModified" datetime="2025-05-12T22:14:58+08:00">2025-05-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%89%A9%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">物理</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%89%A9%E7%90%86/%E9%87%8F%E5%AD%90%E5%9C%BA%E8%AE%BA/" itemprop="url" rel="index"><span itemprop="name">量子场论</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言">前言</h2>
<p>我会从真空的自由场论出发,一步一步引入源函数与相互作用,并展示这些概念在每一步中的作用及其物理意义,我相信这能解答初学者们面临的一些困惑,包括路径积分量子化对真空的令人不安的处理,以及为什么自由场论不能实现介子散射(按照我们的逻辑,这是显然的),这也与相互作用场论这一名称以及标量场的<span
class="math inline">\(\rm{Feynman}\)</span>规则自洽.重要的是,所有的细节都将清楚地呈现,因为大部分量子场论教科书都没有做到这一点.</p>
<p>当然,我会在这篇文章中兼顾路径积分量子化和正则量子化,即便你只学过其中一种,也不会造成太大的阅读障碍.</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025/05/04/%E8%B4%B9%E6%9B%BC%E5%9B%BE/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/femboy.jpg">
      <meta itemprop="name" content="SiyuanLei">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SiyuanLei's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | SiyuanLei's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/05/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">计算机系统概论笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-05-04 00:00:00" itemprop="dateCreated datePublished" datetime="2025-05-04T00:00:00+08:00">2025-05-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-05-27 17:35:30" itemprop="dateModified" datetime="2025-05-27T17:35:30+08:00">2025-05-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/EE/" itemprop="url" rel="index"><span itemprop="name">EE</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/EE/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">计算机系统</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="第一部分基本概念">第一部分:基本概念</h2>
<h3 id="计算机系统概述">计算机系统概述</h3>
<p>从问题描述到电子运转的转换层次如下</p>
<p>问题–&gt;算法–&gt;语言–&gt;机器结构(ISA)–&gt;微结构–&gt;电路–&gt;器件</p>
<ol type="1">
<li>用自然语言提出一个问题</li>
<li>将问题转化成具体的算法,算法有三大特点
<ol type="1">
<li>确定性:每个操作的步骤是清晰的,可定义的</li>
<li>可计算性:每一步都可以被计算机执行</li>
<li>有限性:过程是会终止的</li>
</ol></li>
<li>将算法用程序语言实现,而程序语言就是机器语言,它又分成高级语言和低级语言
<ol type="1">
<li>高级语言和计算机底层相关性弱,比如Python,Matlab</li>
<li>低级语言和计算机底层相关性强,通常一种低级语言对应一种计算机,称为某某机器的汇编语言</li>
</ol></li>
<li>将编程语言转换成特定计算机的指令集.指令集架构(Instruction Set
Architecture,ISA)是程序和计算机硬件之间接口的一个完整定义.将高级语言翻译成ISA指令的过程由<strong>编译器</strong>完成,而将计算机特定汇编语言翻译成其ISA的过程由<strong>汇编器</strong>完成.ISA的定义包括:
<ol type="1">
<li>计算机可以执行的指令集合,即计算机所能执行的操作</li>
<li>每个操作所需数据是什么,即操作数</li>
<li>可接受的操作数表达方式,即数据类型</li>
<li>获取操作数的机制,即定位各种操作数的不同方法,称为寻址模式</li>
</ol></li>
<li>将ISA转换成对应的实现,实现的具体组织称为微结构.例如很多处理器都实现了X86这种ISA结构,但是每个处理器的实现方法不同,即有自己的微结构.</li>
<li>微结构则是由一些简单的逻辑电路实现的</li>
<li>每个基本的逻辑电路,都是按照特定的器件技术实现的</li>
</ol>
<h3 id="bit数据类型及其运算">bit,数据类型及其运算</h3>
<p><strong>原码</strong>第一位是符号位,0代表正数,1代表负数.后面的位数都是数值位.</p>
<p><strong>反码</strong>正数的反码和原码相同,负数的反码保持符号位是1,数值位取反</p>
<p><strong>补码</strong>正数的补码和原码相同,负数的补码是在其反码的基础上加1.</p>
<p><strong>注意事项</strong></p>
<ul>
<li>如果已知一个数的补码,对其再求一次补码就可以得到原码</li>
<li>4位字长的原码和反码表示的数值范围都是-7<sub>+7,补码表示的范围是-8</sub>+7.规定+0的原码,反码,补码都是0000,-0只有原码(1000)和补码(1111),没有补码;-8只有补码(1000),没有原码和反码</li>
</ul>
<p><strong>符号扩展</strong>在二进制补码正数前加上任意多个0不改变它的值,在二进制补码负数前加上任意多个1不改变它的值.</p>
<p><strong>溢出</strong>两个数进行补码运算,如果结果的正负号和预期相反,那么就就称为溢出.只有在两种同符号运算的情况下,才会发生溢出.</p>
<p><strong>浮点数</strong>IEEE浮点数的定义如下</p>
<table>
<thead>
<tr>
<th style="text-align: center;">符号位</th>
<th style="text-align: center;">数值范围</th>
<th style="text-align: center;">数值精度</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">(S)</td>
<td style="text-align: center;">指数(exponent)</td>
<td style="text-align: center;">尾数(fraction)</td>
</tr>
<tr>
<td style="text-align: center;">1 bit</td>
<td style="text-align: center;">8 bit</td>
<td style="text-align: center;">23 bit</td>
</tr>
</tbody>
</table>
<p>浮点数的计算公式如下: <span class="math display">\[N=(-1)^s\times
1.\rm{fraction}\times 2^{\rm{exponent}-127},~1\leq \rm{exponent}\leq
254\]</span></p>
<p><strong>例1</strong><span
class="math inline">\(-6\frac{5}{8}\)</span>的IEEE浮点数是多少?</p>
<p><strong>解</strong><span
class="math display">\[-6\frac{5}{8}=-(1\times 2^2+1\times 2^1+0\times
2^0+1\times 2^{-1}+0\times 2^{-1}+1\times 2^{-3})=-1.10101\times
2^2\]</span></p>
<p>符号位是<span class="math inline">\(1\)</span>,指数是<span
class="math inline">\(2+127=129=10000001\)</span>,尾数为<span
class="math inline">\(10101000000000000000000\)</span> 于是IEEE浮点数为
<span
class="math display">\[1(1~bit)~~10000001(8~bit)~~10101000000000000000000(23~bit)\]</span></p>
<p><strong>例2</strong>IEEE浮点数 <span
class="math display">\[0~01111011~00000000000000000000000\]</span>
表示的是什么数?</p>
<p><strong>解</strong><span
class="math inline">\(01111011-127=123-127=-4\)</span>,位数部分全为<span
class="math inline">\(0\)</span>,整个数为正数,所以 <span
class="math display">\[+1.00000000000000000000000\times
2^{-4}=\frac{1}{16}\]</span></p>
<h3 id="内存">内存</h3>
<p>内存是由一定数目的”位置”组成的,其中每个”位置”可以被单独识别并且存放一个数据.我们称用来<strong>识别位置的一组数</strong>为<strong>地址</strong>,称存储在<strong>各个位置中的bit数目</strong>为<strong>寻址能力</strong>.内存中可独立识别的位置总数为内存的<strong>寻址空间</strong>.</p>
<p>例如,<span class="math inline">\(2^3\times
16\)</span>大小的内存,其寻址空间大小为<span
class="math inline">\(2^3=8\)</span>,寻址能力为<span
class="math inline">\(16 bit\)</span>的宽度.</p>
<h2 id="第二部分lc-3及其汇编语言">第二部分:LC-3及其汇编语言</h2>
<h3 id="冯诺依曼模型">冯诺依曼模型</h3>
<h4 id="组成部分">组成部分</h4>
<p>冯诺依曼模型包括五个组成部分:</p>
<ol type="1">
<li>内存memory</li>
<li>处理单元processing unit</li>
<li>输入input</li>
<li>输出output</li>
<li>控制单元control unit</li>
</ol>
<p>下面我们一一介绍</p>
<h5 id="内存-1">内存</h5>
<p>今天的计算机都是<span class="math inline">\(2^{28}\times
8~\rm{bit}\)</span>模式,也就是说有<span
class="math inline">\(2^{28}\)</span>个存储单元,每个存储单元可以存储<span
class="math inline">\(8~\rm{bit}\)</span>的信息.我们称寻址空间为<span
class="math inline">\(2^{28}\)</span>,寻址能力为<span
class="math inline">\(8\)</span>位(<span
class="math inline">\(1~\rm{byte}=8~\rm{bit}\)</span>).</p>
<p>访问内存的第一步,就是向内存提供被访问的内存单元的地址</p>
<ul>
<li>读操作:首先将被访问内存单元的地址放入CPU的内存地址寄存器(Memory
Address Register,
MAR),然后发送读信号通知内存,最后内存将该单元中存放的数据发送到内存数据寄存器(Memory
Data Register, MDR).</li>
<li>写操作:首先将被访问内存单元的地址放入CPU的MAR,然后将要写入的数据放入CPU的MDR,再向内存发送写信号,最后MDR的内容被写入MAR指向的内存单元.</li>
</ul>
<h5 id="处理单元">处理单元</h5>
<p>处理单元是信息被真正处理的地方,其中最简单的功能单元是算数逻辑单元ALU.ALU所能处理的量化大小称为该机器的”字长”,而量化的基本单位称为一个”字”.例如,LC-3所能处理的量化大小为<span
class="math inline">\(16-\rm{bit}\)</span>,所以称LC-3是一个<span
class="math inline">\(16\)</span>位的机器.</p>
<p>通常会在ALU周围配置少量存储器,以便存放最近生成的中间计算结果,这样可以减少内存访问浪费的时间.临时存储器最常见的设计方式就是一组寄存器,其中每个寄存器的宽度和ALU处理数据的宽度一致,我们说每个寄存器存放了一个字.在LC-3中,有<span
class="math inline">\(8\)</span>个这样的寄存器(<span
class="math inline">\(\rm{R0,R1,\cdots,R7}\)</span>),每个宽度为<span
class="math inline">\(16-\rm{bit}\)</span>.</p>
<h5 id="输入和输出单元">输入和输出单元</h5>
<p>输入和输出设备的种类很多,我们称它们为”外围设备”.常见的输入设备是键盘,输出设备是显示器.</p>
<h5 id="控制单元">控制单元</h5>
<p>控制单元控制其他所有单元之间的协同工作.控制单元中有几个特殊的寄存器:</p>
<ol type="1">
<li>指令寄存器:保存的是正在被执行的那条指令.</li>
<li>PC寄存器:指向下一条待处理的指令,这个寄存器又称为”程序计数器”或者”指令指针”,这是因为该寄存器的内容实际上指向下一条待处理的指令的地址.</li>
</ol>
<h4 id="指令处理">指令处理</h4>
<p>冯诺依曼模型的核心思想是,程序和数据都是以<span
class="math inline">\(\rm{bit}\)</span>流的方式存放在计算机内存中,程序在控制单元的控制下,依次完成指令的读取和执行.</p>
<h5 id="指令">指令</h5>
<p>指令是计算机执行的最小单位.指令本身又是由操作码和操作数两部分组成.操作码表示该指令是做什么的,操作数表示该操作的对象有哪些.LC-3指令长度是<span
class="math inline">\(16-\rm{bit}\)</span>,其中<span
class="math inline">\(\rm{bit}[15:12]\)</span>表示操作码,<span
class="math inline">\(\rm{bit}[11:0]\)</span>对应操作数的表示.</p>
<p><strong>例1</strong>ADD指令</p>
<table>
<thead>
<tr>
<th>15 14 13 12</th>
<th>11 10 9</th>
<th>8 7 6</th>
<th>5</th>
<th>4 3</th>
<th>2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td>0 0 0 1</td>
<td>1 1 0</td>
<td>0 1 0</td>
<td>0</td>
<td>0 0</td>
<td>1 1 0</td>
</tr>
</tbody>
</table>
<p>其中: <span class="math inline">\(\rm{bit}[15:12]=0001\)</span>
表示加法ADD操作 <span class="math inline">\(\rm{bit}[11:9]=110\)</span>
表示目的寄存器是<span class="math inline">\(\rm{R6}\)</span> <span
class="math inline">\(\rm{bit}[8:6]=010,\rm{bit}[2:0]=110\)</span>
表示源寄存器<span class="math inline">\(\rm{R2}\)</span>和<span
class="math inline">\(\rm{R6}\)</span> <span
class="math inline">\(\rm{bit}[5:3]\)</span> 的含义以后再进行解释</p>
<p>上述指令的解释为将寄存器2和寄存器6的内容相加,然后将结果放入寄存器6.</p>
<p><strong>例2</strong>LDR指令</p>
<p>LD表示load,表示从内存的某个位置读取内容,然后装入某个寄存器中.R表示读取内存地址的机制(寻址模式),这里表示的意思是”base+offset”模式.</p>
<table>
<thead>
<tr>
<th>15 14 13 12</th>
<th>11 10 9</th>
<th>8 7 6</th>
<th>5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td>0 1 1 0</td>
<td>0 1 0</td>
<td>0 1 1</td>
<td>0 0 0 1 1 0</td>
</tr>
</tbody>
</table>
<p>其中: <span class="math inline">\(\rm{bit}[15:12]=0110\)</span>
表示LDR操作 <span class="math inline">\(\rm{bit}[11:9]=010\)</span>
表示目的寄存器是<span class="math inline">\(\rm{R2}\)</span> <span
class="math inline">\(\rm{bit}[8:6]=011\)</span> 表示偏移寄存器<span
class="math inline">\(\rm{R3}\)</span> <span
class="math inline">\(\rm{bit}[5:0]=000110\)</span> 表示基址<span
class="math inline">\(6\)</span></p>
<p>上述指令的解释为将<span
class="math inline">\(\rm{R3}\)</span>的内容和<span
class="math inline">\(\rm{bit}[5:0]\)</span>的补码数值相加得到内存地址,然后将该地址指向的内存单元的内容放入<span
class="math inline">\(\rm{R2}\)</span>中.</p>
<h5 id="指令周期">指令周期</h5>
<p>指令的处理过程是在控制单元的控制下一步步地完成的.我们称这个执行的步骤顺序为指令周期,其中每一步称为节拍.一个指令周期包括6个节拍:</p>
<ol type="1">
<li>取指令(FETCH)</li>
<li>译码(DECODE)</li>
<li>地址计算(EVALUATE ADDRESS)</li>
<li>取操作数(FETCH OPERAND)</li>
<li>执行(EXECUTE)</li>
<li>存放结果(STORE RESULT)</li>
</ol>
<h6 id="取指令">取指令</h6>
<p>该节拍负责从内存中(整个程序的所有指令都保存在内存里面)取出下一条待执行的指令,将其放入控制单元的指令寄存器IR.而取出下一条待执行的指令,就需要知道它在内存中的地址,而程序计数器PC就是负责这个任务.FETCH节拍的具体过程如下:</p>
<ol type="1">
<li>将PC寄存器的内容装入MAR</li>
<li>将MAR对应的内存单元的内容(即下一条指令)装入MDR</li>
<li>控制单元将MDR的内容装入IR寄存器</li>
<li>PC+1</li>
</ol>
<p>上面的每一个动作就是一个机器周期,或者叫时钟周期.</p>
<h6 id="译码">译码</h6>
<p>将<span
class="math inline">\(\rm{IR}[15:12]\)</span>作为输入,输出<span
class="math inline">\(16\)</span>根使能线,但是这<span
class="math inline">\(16\)</span>根使能线中有且仅有一条是有效的.</p>
<h6 id="地址计算">地址计算</h6>
<p>不是所有的指令都有这个环节.</p>
<h6 id="取操作数">取操作数</h6>
<p>源操作数既可以来自寄存器,又可以来自内存.</p>
<h6 id="执行">执行</h6>
<p>没什么好说的</p>
<h6 id="存放结果">存放结果</h6>
<p>之前节拍的执行结果被写入目的寄存器.</p>
<h5 id="改变执行顺序">改变执行顺序</h5>
<p>由于任意的指令周期都是从将PC的内容装入MAR中开始的,如果我们想要改变指令执行的顺序,就必须在PC+1与下一条指令的取指令节拍开始之前修改PC+1的值.控制指令就是用新的地址覆盖PC+1的内容.</p>
<p><strong>例</strong>JMP指令</p>
<p>假设该指令存放在内存<span
class="math inline">\(\rm{x36A2}\)</span>处.</p>
<table>
<thead>
<tr>
<th>15 14 13 12</th>
<th>11</th>
<th>10 9</th>
<th>8 7 6</th>
<th>5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 1 0 0</td>
<td>0</td>
<td>0 0</td>
<td>0 1 1</td>
<td>0 0 0 0 0 0</td>
</tr>
</tbody>
</table>
<p>其中: <span class="math inline">\(\rm{bit}[15:12]=0001\)</span>
表示JMP操作 <span class="math inline">\(\rm{bit}[8:6]=011\)</span>
表示寄存器<span
class="math inline">\(\rm{R3}\)</span>中存储了下一条指令</p>
<p>上述指令的解释为将寄存器3的内容放入PC寄存器,覆盖掉当前PC+1,换言之,下一条要执行的指令在内存中的地址来自<span
class="math inline">\(\rm{R3}\)</span>.</p>
<p>具体来说,首先在指令执行之初,PC的内容为<span
class="math inline">\(\rm{x36A2}\)</span>,在取指令节拍,整条JMP指令放入IR寄存器,同时PC自增变成<span
class="math inline">\(\rm{x36A3}\)</span>,假设<span
class="math inline">\(\rm{R3}\)</span>的内容是<span
class="math inline">\(\rm{x5446}\)</span>,那么在执行节拍,PC的内容就被覆盖为<span
class="math inline">\(\rm{x5446}\)</span>.这就导致了下一条指令来自内存中地址为<span
class="math inline">\(\rm{x5446}\)</span>,而不是<span
class="math inline">\(\rm{x36A3}\)</span>.</p>
<h5 id="停机操作">停机操作</h5>
<p>用户程序是受控于操作系统而执行的,即操作系统有终值用户程序的办法.对于计算机来说,用户程序和操作系统没有区别,都是一堆指令的集合.</p>
<p>对于用户程序来说,想要停止用户程序,就要在用户程序的结尾处放置一个控制指令,该指令的任务就是修改Pc寄存器,使之跳转到操作系统,而操作系统也借这个时刻启动一个新的用户程序.</p>
<h3 id="lc-3结构">LC-3结构</h3>
<h4 id="lc-3-isa概述">LC-3 ISA概述</h4>
<p>ISA定义了软件编程所需要的必要而完整的描述,换言之,ISA向以机器语言编程的程序员提供有关控制机器所需要的全部信息.ISA主要包含如下信息:</p>
<ol type="1">
<li>内存组织方式</li>
<li>寄存器组</li>
<li>指令集(包括操作码,数据类型,寻址模式)</li>
</ol>
<h5 id="内存组织">内存组织</h5>
<p>LC-3的可寻址空间大小为<span
class="math inline">\(2^{16}\)</span>(这些空间并不是全部用于内存),寻址基本单位是<span
class="math inline">\(16\)</span>位.LC-3中数据处理的基本单位是<span
class="math inline">\(16\)</span>位,所以称<span
class="math inline">\(16\)</span>位为一个字,也称LC-3是一个字寻址机器.</p>
<h5 id="寄存器">寄存器</h5>
<p>由于从内存中获取数据的速度很慢(不止一个周期),所以计算机会提供临时存储空间,它们的访问速度是一个周期.临时存储空间最常见的实现方式是寄存器,LC-3提供了一组通用寄存器,其中每个寄存器都叫做通用寄存器.</p>
<p>寄存器有以下特性:</p>
<ol type="1">
<li>记忆特性:存储的信息可以被再次读出.对于LC-3,每个寄存器的大小为一个字,即<span
class="math inline">\(16\)</span>位</li>
<li>独立寻址:每个寄存器有唯一的标识.LC-3,提供了<span
class="math inline">\(8\)</span>个寄存器<span
class="math inline">\(\rm{R0,R1,\cdots,R7}\)</span></li>
</ol>
<h5 id="指令集">指令集</h5>
<p>一条指令分为两个部分,第一个部分是操作码(做什么),第二个部分是操作数(对谁操作).一个ISA的指令集定义包括:操作码的集合,数据类型,寻址模式.其中寻址模式决定了操作数的存放位置.</p>
<h5 id="操作码">操作码</h5>
<p>LC-3的ISA结构定义了<span
class="math inline">\(15\)</span>条指令,注意到<span
class="math inline">\(\rm{bit}[15:12]\)</span>这<span
class="math inline">\(4~\rm{bit}\)</span>的操作码本来可以定义<span
class="math inline">\(16\)</span>条指令,但我们将<span
class="math inline">\(1101\)</span>先预留出来.</p>
<p>所有指令可以分成三类:</p>
<ol type="1">
<li>运算指令:算数运算或者逻辑运算,负责处理信息</li>
<li>数据搬移指令:将数据从一个地方搬到另一个地方,如内存和寄存器之间,内存,寄存器和输入输出之间</li>
<li>控制指令:改变程序的执行顺序</li>
</ol>
<h5 id="数据类型">数据类型</h5>
<p>数据类型是指信息的表达方式,即ISA的操作码是怎样理解这些表达信息的.如果ISA的操作码能识别/处理某种数据类型的信息,那么我们称该ISA支持这种数据类型.LC-3所支持的唯一的数据类型就是补码整数.</p>
<h5 id="寻址模式">寻址模式</h5>
<p>寻址模式是定义操作数位置的机制.操作数的来源有三个:</p>
<ol type="1">
<li>内存</li>
<li>寄存器</li>
<li>指令本身</li>
</ol>
<p>称存在于指令本身的操作数为”字面值”或”立即数”.</p>
<p>而LC-3总共支持<span class="math inline">\(5\)</span>种寻址模式:</p>
<ol type="1">
<li>立即数</li>
<li>寄存器</li>
<li>相对寻址</li>
<li>间接寻址</li>
<li>基址偏移</li>
</ol>
<h5 id="条件码">条件码</h5>
<p>LC-3具有三个位寄存器,每当<span
class="math inline">\(8\)</span>个通用寄存器中的任意一个被修改或者写入时,这三个<span
class="math inline">\(\rm{bit}\)</span>位就会发生变化.这三个位寄存器分别为<span
class="math inline">\(N,Z,P\)</span>,分别代表负数,零,正数.即每当通用寄存器被写入时,根据写入的结果是负数,零,正数,分别设置这三个位.例如,写入负数,置<span
class="math inline">\(N=1,N=P=0\)</span>.我们称这三个位寄存器为”条件码”.</p>
<h4 id="运算指令">运算指令</h4>
<p>LC-3只支持三种运算:ADD,AND,NOT</p>
<p><strong>例1</strong>NOT指令</p>
<p>NOT指令是唯一的单操作数指令.</p>
<table>
<thead>
<tr>
<th>15 14 13 12</th>
<th>11 10 9</th>
<th>8 7 6</th>
<th>5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 0 0 1</td>
<td>0 1 1</td>
<td>1 0 1</td>
<td>1 1 1 1 1 1</td>
</tr>
</tbody>
</table>
<p>其中: <span class="math inline">\(\rm{bit}[15:12]=1001\)</span>
表示取反NOT操作 <span class="math inline">\(\rm{bit}[11:9]=011\)</span>
表示目的寄存器是<span class="math inline">\(\rm{R3}\)</span> <span
class="math inline">\(\rm{bit}[8:6]=101\)</span> 表示源寄存器<span
class="math inline">\(\rm{R5}\)</span> <span
class="math inline">\(\rm{bit}[5:0]\)</span> 全部为<span
class="math inline">\(1\)</span></p>
<p>上述指令的解释为将寄存器5的内容取反,然后放入寄存器3.</p>
<p><strong>例2</strong>AND指令</p>
<p>AND(操作码为0101)和ADD(操作码为0001)都是双操作数指令,它们都需要两个<span
class="math inline">\(16\)</span>位源操作数.AND和ADD的源操作数之一(<span
class="math inline">\(\rm{bit}[8:6]\)</span>)以及目的寄存器(<span
class="math inline">\(\rm{bit}[11:9]\)</span>)都是寄存器寻址.对于第二个操作数的寻址方式,则是取决于<span
class="math inline">\(\rm{bit}[5]\)</span>的值,若为<span
class="math inline">\(1\)</span>,则是立即数寻址,此时<span
class="math inline">\(\rm{bit}[4:0]\)</span>表示立即数;若为<span
class="math inline">\(0\)</span>,则是寄存器寻址,此时源寄存器为<span
class="math inline">\(\rm{bit}[2:0]\)</span>,<span
class="math inline">\(\rm{bit}[4:3]=00\)</span>.</p>
<p>下面是<strong>寄存器寻址</strong>的一个例子</p>
<table>
<thead>
<tr>
<th>15 14 13 12</th>
<th>11 10 9</th>
<th>8 7 6</th>
<th>5</th>
<th>4 3</th>
<th>2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td>0 0 0 1</td>
<td>0 0 1</td>
<td>1 0 0</td>
<td>0</td>
<td>0 0</td>
<td>1 0 1</td>
</tr>
</tbody>
</table>
<p>其中: <span class="math inline">\(\rm{bit}[15:12]=0001\)</span>
表示加法ADD操作 <span class="math inline">\(\rm{bit}[11:9]=001\)</span>
表示目的寄存器是<span class="math inline">\(\rm{R1}\)</span> <span
class="math inline">\(\rm{bit}[8:6]=100,\rm{bit}[2:0]=101\)</span>
表示源寄存器<span class="math inline">\(\rm{R4}\)</span>和<span
class="math inline">\(\rm{R5}\)</span> <span
class="math inline">\(\rm{bit}[5]=0\)</span> 表示寄存器寻址,此时<span
class="math inline">\(\rm{bit}[4:3]=00\)</span></p>
<p>上述指令的解释为将寄存器4和寄存器5的内容相加,然后将结果放入寄存器1.</p>
<p>下面是<strong>立即数寻址</strong>的一个例子</p>
<table>
<thead>
<tr>
<th>15 14 13 12</th>
<th>11 10 9</th>
<th>8 7 6</th>
<th>5</th>
<th>4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td>0 0 0 1</td>
<td>0 0 1</td>
<td>1 0 0</td>
<td>1</td>
<td>1 1 1 1 0</td>
</tr>
</tbody>
</table>
<p>其中: <span class="math inline">\(\rm{bit}[15:12]=0001\)</span>
表示加法ADD操作 <span class="math inline">\(\rm{bit}[11:9]=001\)</span>
表示目的寄存器是<span class="math inline">\(\rm{R1}\)</span> <span
class="math inline">\(\rm{bit}[8:6]=100\)</span> 表示源寄存器<span
class="math inline">\(\rm{R4}\)</span> <span
class="math inline">\(\rm{bit}[5]=1\)</span> 表示立即数寻址,此时<span
class="math inline">\(\rm{bit}[4:0]=11110\)</span>为立即数</p>
<p>上述指令的解释为将<span
class="math inline">\(\rm{bit}[4:0]=11110\)</span>做<span
class="math inline">\(16\)</span>位符号扩展,然后与寄存器4的内容相加,然后将结果放入寄存器1.</p>
<h4 id="数据搬移指令">数据搬移指令</h4>
<p>我们称将数据从内存移入寄存器为”装载(Load)“,将数据从寄存器放入内存为”存储(Store)“.注意,在这种情况下,数据源的内容不会随着数据的移动而改变,但是目的操作数的内容会被刷新,以前的内容会被覆盖.</p>
<p>LC-3有<span
class="math inline">\(7\)</span>种数据搬移指令:LD,LDR,LDI,LEA,ST,STR,STI</p>
<p>Load和Store的指令格式如下:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">操作码</td>
<td style="text-align: center;">DR或SR</td>
<td style="text-align: center;">地址生成位</td>
</tr>
</tbody>
</table>
<p>数据搬移指令需要有两个操作数:源和目的,且两个操作数之一必然是寄存器,另一个则是内存或者输入输出设备.</p>
<p><span
class="math inline">\(\rm{bit}[11:9]\)</span>标识了操作数之一,即寄存器,如果是Load类型的指令,那么这代表目的寄存器(DR);如果是Store类型的指令,那么这代表源寄存器(SR).</p>
<p><span
class="math inline">\(\rm{bit}[8:0]\)</span>是”地址生成位”,这表示基于<span
class="math inline">\(\rm{bit}[8:0]\)</span>的信息,可以计算出第二个操作数的<span
class="math inline">\(16\)</span>位地址.LC-3中,有<span
class="math inline">\(4\)</span>种生成地址(或者说阐释<span
class="math inline">\(\rm{bit}[8:0]\)</span>)的方法,也就是<span
class="math inline">\(4\)</span>种寻址模式.</p>
<h5 id="pc相对寻址">PC相对寻址</h5>
<p>LD(操作码为0010)和ST(操作码为0011)采用PC相对寻址.此时<span
class="math inline">\(\rm{bit}[8:0]\)</span>代表的是对于当前PC值的偏移量.地址计算方法是,将<span
class="math inline">\(\rm{bit}[8:0]\)</span>做<span
class="math inline">\(16\)</span>位符号扩展,然后和PC当前值(已增量)相加得到内存单元的地址.</p>
<p><strong>例</strong>LD指令</p>
<p>假设下面这条指令存放在<span
class="math inline">\(\rm{x4018}\)</span>处.</p>
<table>
<thead>
<tr>
<th>15 14 13 12</th>
<th>11 10 9</th>
<th>8 7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td>0 0 1 0</td>
<td>0 1 0</td>
<td>1 1 0 1 0 1 1 1 1</td>
</tr>
</tbody>
</table>
<p>其中: <span class="math inline">\(\rm{bit}[15:12]=0010\)</span>
表示PC相对寻址的Load操作 <span
class="math inline">\(\rm{bit}[11:9]=010\)</span> 表示目的寄存器是<span
class="math inline">\(\rm{R2}\)</span> <span
class="math inline">\(\rm{bit}[8:0]=110101111\)</span>
表示偏移量,符号扩展之后为<span
class="math inline">\(\rm{xFFAF}\)</span></p>
<p>上述指令的解释为先计算<span
class="math inline">\((\rm{x4018}+1)+\rm{xFFAF}=\rm{x3FC8}\)</span>,将<span
class="math inline">\(\rm{x3FC8}\)</span>装入MAR,然后读取内存地址为<span
class="math inline">\(\rm{x3FC8}\)</span>的内容装入MDR中,最后把MDR的内容加载到<span
class="math inline">\(R2\)</span>中.</p>
<p>注意这种寻址方式计算出来的内存地址范围是受限的,即该地址只能在当前LD或者ST指令所在地址的<span
class="math inline">\(+256\)</span>和<span
class="math inline">\(-255\)</span>范围内,另外<span
class="math inline">\(\rm{bit}[8:0]\)</span>是有符号数值.</p>
<h5 id="间接寻址">间接寻址</h5>
<p>LDI(操作码为1010)和STI(操作码为1011)采用间接寻址.首先用和LD/ST相同的方法算出一个地址,但是这个地址的内容又是另外一个地址,这个新的地址的内容才是源操作数.这种寻址方式的范围是整个内存空间.</p>
<p><strong>例</strong>LDI指令</p>
<p>假设下面这条指令存放在<span
class="math inline">\(\rm{x4A1B}\)</span>处.</p>
<table>
<thead>
<tr>
<th>15 14 13 12</th>
<th>11 10 9</th>
<th>8 7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 0 1 0</td>
<td>0 1 1</td>
<td>1 1 1 0 0 1 1 0 0</td>
</tr>
</tbody>
</table>
<p>其中: <span class="math inline">\(\rm{bit}[15:12]=0010\)</span>
表示间接寻址的Load操作 <span
class="math inline">\(\rm{bit}[11:9]=011\)</span> 表示目的寄存器是<span
class="math inline">\(\rm{R3}\)</span> <span
class="math inline">\(\rm{bit}[8:0]=110101111\)</span>
表示偏移量,符号扩展之后为<span
class="math inline">\(\rm{xFFCC}\)</span></p>
<p>上述指令的解释为先计算<span
class="math inline">\((\rm{x4A1B}+1)+\rm{xFFCC}=\rm{x49E8}\)</span>,将<span
class="math inline">\(\rm{x49E8}\)</span>装入MAR,然后读取内存地址为<span
class="math inline">\(\rm{x49E8}\)</span>的内容(假设为<span
class="math inline">\(\rm{x2110}\)</span>)装入MDR中,而<span
class="math inline">\(\rm{x2110}\)</span>不是操作数,而是地址,所以<span
class="math inline">\(\rm{x2110}\)</span>又被装入MAR,再次读取内存地址为<span
class="math inline">\(\rm{x2110}\)</span>的内容装入到MDR,最后把MDR的内容加载到<span
class="math inline">\(R3\)</span>中.</p>
<h5 id="基址偏移寻址">基址偏移寻址</h5>
<p>LDR(操作码为0110)和STR(操作码为0111)采用基址+偏移寻址.操作数的地址是由<span
class="math inline">\(\rm{bit}[5:0]\)</span>的<span
class="math inline">\(6~\rm{bit}\)</span>偏移量和<span
class="math inline">\(\rm{bit}[8:6]\)</span>的寄存器的内容(基址)相加得出.</p>
<p><strong>例</strong>LD指令</p>
<p>假设下面这条指令存放在<span
class="math inline">\(\rm{x4018}\)</span>处.</p>
<table>
<thead>
<tr>
<th>15 14 13 12</th>
<th>11 10 9</th>
<th>8 7 6</th>
<th>5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td>0 1 1 0</td>
<td>0 0 1</td>
<td>0 1 0</td>
<td>0 1 1 1 0 1</td>
</tr>
</tbody>
</table>
<p>其中: <span class="math inline">\(\rm{bit}[15:12]=0110\)</span>
表示基址+偏移寻址的Load操作 <span
class="math inline">\(\rm{bit}[11:9]=001\)</span> 表示目的寄存器是<span
class="math inline">\(\rm{R1}\)</span> <span
class="math inline">\(\rm{bit}[8:6]=010\)</span> 表示基址寄存器<span
class="math inline">\(\rm{R2}\)</span>,其内容假设为<span
class="math inline">\(\rm{x2345}\)</span> <span
class="math inline">\(\rm{bit}[5:0]=011101\)</span> 符号扩展为<span
class="math inline">\(\rm{x001D}\)</span></p>
<p>上述指令的解释为先计算<span
class="math inline">\(\rm{x2345}+\rm{x001D}=\rm{x2362}\)</span>,将<span
class="math inline">\(\rm{x2362}\)</span>装入MAR,然后读取内存地址为<span
class="math inline">\(\rm{x2362}\)</span>的内容装入MDR中,最后把MDR的内容加载到<span
class="math inline">\(R1\)</span>中.</p>
<h5 id="立即数寻址">立即数寻址</h5>
<p>立即数寻址模式只用于有效地址装载指令,用途是对寄存器初始化,即向寄存器中装入一个地址.LEA(操作码为1110)将增量PC直接和<span
class="math inline">\(\rm{bit}[8:0]\)</span>的符号扩展相加,并装入<span
class="math inline">\(\rm{bit}[11:9]\)</span>指定的寄存器.</p>
<p><strong>例</strong>LEA指令</p>
<p>设这条指令位于<span class="math inline">\(\rm{x4018}\)</span>处.</p>
<table>
<thead>
<tr>
<th>15 14 13 12</th>
<th>11 10 9</th>
<th>8 7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 1 1 0</td>
<td>1 0 1</td>
<td>1 1 1 1 1 1 1 0 1</td>
</tr>
</tbody>
</table>
<p>其中: <span class="math inline">\(\rm{bit}[15:12]=1110\)</span>
表示LEA操作 <span class="math inline">\(\rm{bit}[11:9]=101\)</span>
表示目的寄存器是<span
class="math inline">\(\rm{R5}\)</span>,假设内容为<span
class="math inline">\(\rm{x4018}\)</span> <span
class="math inline">\(\rm{bit}[8:0]=111111101\)</span> 为<span
class="math inline">\(-3\)</span></p>
<p>上述指令的解释为先计算<span
class="math inline">\((\rm{x4018}+1)-3=\rm{x4016}\)</span>,将<span
class="math inline">\(\rm{x4016}\)</span>装入<span
class="math inline">\(\rm{R5}\)</span>.</p>
<h4 id="控制指令">控制指令</h4>
<p>控制指令是指可以改变指令执行顺序的指令.如果没有控制指令,那么当前指令完毕后的下一条指令一定是内存位置顺序的下一条,这是因为取指令之后,PC会自动加一.</p>
<p>LC-3中有<span
class="math inline">\(5\)</span>种操作码可以打破这种顺序:条件跳转,无条件跳转,子程序(又称为函数)调用,TRAP,中断返回.</p>
<h5 id="条件跳转和无条件跳转">条件跳转和无条件跳转</h5>
<p>条件跳转指令格式如下:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11</th>
<th style="text-align: center;">10</th>
<th style="text-align: center;">9</th>
<th style="text-align: center;">8 7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0 0 0 0</td>
<td style="text-align: center;">N</td>
<td style="text-align: center;">Z</td>
<td style="text-align: center;">P</td>
<td style="text-align: center;">PC偏移</td>
</tr>
</tbody>
</table>
<p>其中:</p>
<p><span
class="math inline">\(\rm{bit}[11],[10],[9]\)</span>分别对应三个条件码.任何一个对寄存器进行操作的指令都会设置这三个条件码,这些指令包括ADD,AND,NOT,LD,LDI,LDR,LEA.</p>
<p>条件码的使用方法是:条件跳转指令通过判断条件码来决定是否改变指令流.</p>
<p>控制指令的执行周期如下:</p>
<ol type="1">
<li>取指令和译码节拍正常,取指令之后,PC自动增量</li>
<li>地址计算节拍,将增量后的PC和指令中<span
class="math inline">\(\rm{bit}[8:0]\)</span>的符号扩展相加求得地址</li>
<li>执行节拍,处理器会检测某个(我们指定的)条件码,如果该条件码的值为<span
class="math inline">\(1\)</span>,那么PC的内容将会被修改成上一个节拍计算出来的地址;如果该条件码的值为<span
class="math inline">\(0\)</span>,那么PC的内容不变.如果我们指定三个条件码都为<span
class="math inline">\(1\)</span>,那么PC内容必然会更新,这就是无条件跳转指令.</li>
</ol>
<h5 id="jmp">JMP</h5>
<p>JMP指令格式如下</p>
<table>
<thead>
<tr>
<th>15 14 13 12</th>
<th>11 10 9</th>
<th>8 7 6</th>
<th>5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 1 0 0</td>
<td>0 0 0</td>
<td>0 1 0</td>
<td>0 0 0 0 0 0</td>
</tr>
</tbody>
</table>
<p>JMP指令的任务就是将基址寄存器(<span
class="math inline">\(\rm{bit}[8:6]\)</span>)的内容装入PC中.JMP指令可以使指令跳转到内存空间的任意位置,这是因为基址寄存器的内容是<span
class="math inline">\(16\)</span>位,它可以表达内存空间的所有地址.</p>
<h5 id="trap">TRAP</h5>
<p>TRAP指令的任务是改变PC的内容,使其指向操作系统所在的空间内部.换言之,就是以当前程序身份跳转至操作系统的某个代码入口开始执行.按照操作系统的术语来说,我们称TRAP指令是激活了操作系统的服务调用.</p>
<p>TRAP指令格式如下</p>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9 8</th>
<th style="text-align: center;">7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1 1 1 1</td>
<td style="text-align: center;">0 0 0 0</td>
<td style="text-align: center;">陷入矢量</td>
</tr>
</tbody>
</table>
<p>其中<span
class="math inline">\(\rm{bit}[7:0]\)</span>表示陷入矢量,陷入矢量表示的是程序希望操作系统执行的服务程序的编号.</p>
<p>操作系统在完成服务调用之后,程序计数器PC将被设置成TRAP指令后的下一条指令地址.</p>
<h3 id="lc-3-汇编语言">LC-3 汇编语言</h3>
<p>汇编语言属于低级语言,每一条汇编语言通常对应于一条ISA指令,高级语言是ISA无关的,而低级语言是ISA相关的.</p>
<p>在汇编语言中,我们采用<strong>助记符</strong>方式来表示AND,NOT之类的<strong>操作码</strong>,而<strong>内存地址</strong>则被SUM,PRODUCT之类的<strong>符号名</strong>所替代.我们称这种命名方式为<strong>符号地址</strong>.</p>
<p>我们先看一个例子:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">; Program to multiply an integer by the constant 6</span><br><span class="line">; Before execution, an integer must be stored in NUMBER</span><br><span class="line">         .ORIG    x3050</span><br><span class="line">         LD       R1,SIX</span><br><span class="line">         LD       R2,NUMBER</span><br><span class="line">         AND      R3,R3,#0</span><br><span class="line">; The inner loop</span><br><span class="line">   AGAIN ADD      R3,R3,R2</span><br><span class="line">         ADD      R1,R1,#-1</span><br><span class="line">         BRp      AGAIN</span><br><span class="line"></span><br><span class="line">         HALT</span><br><span class="line"></span><br><span class="line">   NUMBER .BLKW   1</span><br><span class="line">   SIX    .FILL   x0006</span><br><span class="line"></span><br><span class="line">          .END</span><br></pre></td></tr></table></figure>
<p>解释:</p>
<ol type="1">
<li>以”;“后面的内容是注释</li>
<li>以AND,NOT,HALT,AGAIN的代码行是要翻译成LC-3机器指令的,即真正要运行的</li>
<li>.ORIG,NUMBER,SIX,.END是伪操作,是程序员传递给汇编器的信息,用于提示帮助翻译的过程.</li>
</ol>
<h4 id="指令-1">指令</h4>
<p>汇编语言的指令格式包含<span
class="math inline">\(4\)</span>个部分:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LABEL OPCODE OPERANDS ; COMMENTS</span><br></pre></td></tr></table></figure>
<h5 id="操作码和操作数">操作码和操作数</h5>
<p>在一个汇编指令的所有字段中,操作码(OPCODE,做什么事情)和操作数(OPERAND,被操作的对象)两部分是必须的,操作数的数目取决于具体的操作.</p>
<p>操作数的获取有三种方式:</p>
<ol type="1">
<li>寄存器操作数:直接用R1,R2等显式表示寄存器</li>
<li>内存操作数:内存地址被表达为符号名,例如NUMBER和SIX</li>
<li>立即数操作数:数值被显式表达,“#”表示十进制,“x”表示十六进制,“b”表示二进制.</li>
</ol>
<h5 id="标号">标号</h5>
<p>标号是指向内存单元的符号名,它可以在程序中直接引用.LC-3汇编语言中,一个标号可以包含<span
class="math inline">\(1\)</span>到<span
class="math inline">\(20\)</span>个字符(如大写或者小写的字母或者数字),但是首个字符必须是字母.显式访问内存单元的方式有两种:</p>
<ol type="1">
<li>该单元的内容是指令,该单元地址是跳转指令的目标</li>
<li>该单元的内容是Load或者Store指令访问的数值</li>
</ol>
<p>如果一个内存单元从来不被引用,那么就没有必要为其标号.</p>
<h4 id="伪操作">伪操作</h4>
<p>伪操作又被称为<strong>汇编指令</strong>,它们并不代表(被翻译的汇编)程序中的任何操作,或者说程序执行时它们是不产生任何操作的.它们可以理解为程序员传递给汇编器的信息,用于指导汇编器的汇编操作.LC-3汇编器只有<span
class="math inline">\(5\)</span>种伪操作:</p>
<ol type="1">
<li>.ORIG:.ORIG告诉汇编器将LC-3程序放在内存的什么位置,例如<code>.ORIG x3050</code>表示”从”x3050”开始,于是<code>LD R1,SIX</code>这一条指令就被放在”x3050”处.</li>
<li>.FILL:.FILL告诉汇编器开始占用下一个地址,并且填充初始值(如其操作数),如<code>SIX .FILL x0006</code>,即该单元被初始化为”x0006”.</li>
<li>.BLKW:.BLKW告诉汇编器在程序空间中,开始占用一连串的地址空间,具体的占用数目由.BLKW的伪操作数决定</li>
<li>.STRINGZ:.STRINGZ告诉汇编器连续占用并初始化<span
class="math inline">\(n+1\)</span>个内存单元,其参数(或操作数)是双括号括起来的<span
class="math inline">\(n\)</span>个字符.<span
class="math inline">\(n+1\)</span>个内存单元的前<span
class="math inline">\(n\)</span>个字的内容分别是字符串对应字符的ASCII码的零扩展,内存的最后一个字则被初始化为<span
class="math inline">\(0\)</span>.最后的这个字符”x0000”通常为ASCII码的处理提供了”哨兵机制”.例如下面的代码</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">      .ORIG x3010</span><br><span class="line">HELLO .STRINGZ &quot;Hello, World!&quot;      </span><br></pre></td></tr></table></figure>
<p>导致汇编器将内存x3010到x301D初始化为如下内容:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">地址</th>
<th style="text-align: center;">内容</th>
<th style="text-align: center;">对应字符</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">x3010</td>
<td style="text-align: center;">x0048</td>
<td style="text-align: center;">H</td>
</tr>
<tr>
<td style="text-align: center;">x3011</td>
<td style="text-align: center;">x0065</td>
<td style="text-align: center;">e</td>
</tr>
<tr>
<td style="text-align: center;">x3012</td>
<td style="text-align: center;">x006C</td>
<td style="text-align: center;">l</td>
</tr>
<tr>
<td style="text-align: center;">x3013</td>
<td style="text-align: center;">x006C</td>
<td style="text-align: center;">l</td>
</tr>
<tr>
<td style="text-align: center;">x3014</td>
<td style="text-align: center;">x006F</td>
<td style="text-align: center;">o</td>
</tr>
<tr>
<td style="text-align: center;">x3015</td>
<td style="text-align: center;">x002C</td>
<td style="text-align: center;">,</td>
</tr>
<tr>
<td style="text-align: center;">x3016</td>
<td style="text-align: center;">x0020</td>
<td style="text-align: center;">空格</td>
</tr>
<tr>
<td style="text-align: center;">x3017</td>
<td style="text-align: center;">x0057</td>
<td style="text-align: center;">W</td>
</tr>
<tr>
<td style="text-align: center;">x3018</td>
<td style="text-align: center;">x006F</td>
<td style="text-align: center;">o</td>
</tr>
<tr>
<td style="text-align: center;">x3019</td>
<td style="text-align: center;">x0072</td>
<td style="text-align: center;">r</td>
</tr>
<tr>
<td style="text-align: center;">x301A</td>
<td style="text-align: center;">x006C</td>
<td style="text-align: center;">l</td>
</tr>
<tr>
<td style="text-align: center;">x301B</td>
<td style="text-align: center;">x0064</td>
<td style="text-align: center;">d</td>
</tr>
<tr>
<td style="text-align: center;">x301C</td>
<td style="text-align: center;">x0021</td>
<td style="text-align: center;">!</td>
</tr>
<tr>
<td style="text-align: center;">x301D</td>
<td style="text-align: center;">x0000</td>
<td style="text-align: center;">空字符</td>
</tr>
</tbody>
</table>
<ol start="5" type="1">
<li>.END:.END告诉汇编器”程序结束了”.</li>
</ol>
<h4 id="汇编过程">汇编过程</h4>
<p>我们先看如下代码:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">         .ORIG    x3000       ;</span><br><span class="line">         AND      R2,R2,#0    ;x3000</span><br><span class="line">         LD       R3,PTR      ;x3001</span><br><span class="line">         TRAP     x23         ;x3002</span><br><span class="line">         LDR      R1,R3,#0    ;x3003</span><br><span class="line"></span><br><span class="line">TEST     .ADD     R4,R1,#-4   ;x3004 检测到TEXT</span><br><span class="line">         BRz      OUTPUT      ;x3005</span><br><span class="line"></span><br><span class="line">         NOT      R1,R1       ;x3006</span><br><span class="line">         ADD      R1,R1,R0    ;x3007</span><br><span class="line">         NOT      R1,R1       ;x3008</span><br><span class="line">         BRnp     GETCHAR     ;x3009</span><br><span class="line">         ADD      R2,R2,#1    ;x300A</span><br><span class="line"></span><br><span class="line">GETCHAR  ADD      R3,R3,#1    ;x300B 检测到GETCHAR</span><br><span class="line">         LDR      R1,R3,#0    ;x300C</span><br><span class="line">         BRnzp    TEST        ;x300D</span><br><span class="line"></span><br><span class="line">OUTPUT   LD       R0,ASCII    ;x300E 检测到OUTPUT</span><br><span class="line">         ADD      R0,R0,R2    ;x300F</span><br><span class="line">         TRAP     x21         ;x3010</span><br><span class="line">         TRAP     x25         ;x3011</span><br><span class="line"></span><br><span class="line">ASCII    .FILL    x0030       ;x3012 检测到ASCII</span><br><span class="line">PTR      .FILL    x4000       ;x3013 检测到PTR</span><br><span class="line">         .END</span><br></pre></td></tr></table></figure>
<h5 id="两遍扫描">两遍扫描</h5>
<p>汇编器在将汇编指令翻译成对应的机器指令前,需要对整个汇编程序从头到尾(从开始到.END)扫描一遍,为的是在第一遍扫描时先确定符号名对应的二进制地址,即确定所有符号和地址之间的映射关系.我们称这个映射集合为<strong>符号表</strong>.在建立完符号表之后,汇编器就可以一行一行进行翻译了.</p>
<h6 id="第一遍扫描">第一遍扫描</h6>
<p>第一遍扫描的具体操作如下:</p>
<ol type="1">
<li>丢弃掉所有注释</li>
<li>.ORIG后面的第一条有效指令所分配的地址就是.ORIG后的参数.为了方便说明,我们采用”地址跟踪计数器LC”,LC的初始值由.ORIG指定,也就是x3000.</li>
<li>每识别出一条有效指令,LC的值加<span
class="math inline">\(1\)</span>.如果当前指令行的<strong>头部存在”标识”字段</strong>,那么就为该标识创建符号表项,其地址值就是当前LC的内容</li>
<li>继续识别下一条指令,直至.END</li>
</ol>
<p>按照上面的操作创建的符号表如下</p>
<table>
<thead>
<tr>
<th style="text-align: center;">符号名</th>
<th style="text-align: center;">地址</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">TEST</td>
<td style="text-align: center;">x3004</td>
</tr>
<tr>
<td style="text-align: center;">GETCHAR</td>
<td style="text-align: center;">x300B</td>
</tr>
<tr>
<td style="text-align: center;">OUTPUT</td>
<td style="text-align: center;">x300E</td>
</tr>
<tr>
<td style="text-align: center;">ASCII</td>
<td style="text-align: center;">x3012</td>
</tr>
<tr>
<td style="text-align: center;">PTR</td>
<td style="text-align: center;">x3013</td>
</tr>
</tbody>
</table>
<h6 id="第二遍扫描">第二遍扫描</h6>
<p>没什么好说的,就是把汇编语言翻译成二进制代码.</p>
<h4 id="其他">其他</h4>
<h5 id="可执行映像">可执行映像</h5>
<p>当计算机开始程序的执行时,执行实体又称为”可执行映像”.可执行映像通常是由多个相互独立的模块组装在一起形成的,而这些模块通常又是由不同的程序员,不同的语言(例如汇编语言,C语言,Python等)分别编写的,且有些模块是用户编写的,有些则是操作系统的库程序.所有这些模块在组装之前,是一个个独立的目标文件,最后通过<strong>连接</strong>操作将这些目标拼装成一个可执行映像.</p>
<h5 id="多目标文件">多目标文件</h5>
<p>待完成</p>
<h3 id="输入输出">输入/输出</h3>
<h4 id="输入输出概述">输入/输出概述</h4>
<h5 id="设备寄存器">设备寄存器</h5>
<p>和一个I/O设备进行交互,我们需要多个设备寄存器,即使是最简单的I/O设备,也至少需要两个寄存器:</p>
<ol type="1">
<li>用来保持和计算机之间传输的数据</li>
<li>指示当前设备的状态信息,如”设备是否空闲”,“最近处理的I/O任务”等</li>
</ol>
<h5 id="内存映射io与专用io指令">内存映射I/O与专用I/O指令</h5>
<p>指令访问I/O设备寄存器时,需要明确指明目标寄存器.通常有两种方法实现:</p>
<ol type="1">
<li>一些计算机厂家采用专门的I/O指令来访问,即”专用I/O指令”(不常见)</li>
<li>采用内存操作指令完成I/O操作,即”内存映射I/O”(常用)</li>
</ol>
<p>程序员使用与内存访问相同的指令来操作I/O,所以设备的每个输入输出寄存器都必须有一个和内存中位置相同的标识方式.为此,在ISA的内存地址空间中,专门划分出一段地址,用于设备寄存器的标识映射.换句话说,I/O设备的寄存器被”映射”到一组地址(这些地址是分配给I/O寄存器的,而不是分配给内存位置的),即所谓”内存映射I/O”方式.</p>
<h5 id="异步io与同步io">异步I/O与同步I/O</h5>
<p>I/O设备和处理器的工作节奏是不一致的,因此我们称I/O设备和CPU之间是异步的.异步通信方式下,需要通过一定的协议或者握手机制来控制发送和接收.</p>
<p>实现同步的最简单方式是采用标志.键盘状态寄存器中的标志位提供了最简单的一种握手机制:打字员每输入一个字符,该标志位(Ready位)就被置位,而每次处理器读取之后,都自动将该标志位清零.所以在每次读取输入字符之前,处理器都会检查该Ready位,如果Ready位为<span
class="math inline">\(0\)</span>,表示没有新的字符输入,处理器不再读取输入寄存器,否则有新的字符输入,则处理器执行Load指令,读入输入寄存器的ASCII码值.</p>
<h5 id="中断驱动和轮询">中断驱动和轮询</h5>
<p>I/O设备和处理器交互的方式有两种:中断驱动和轮询.它们之间的根本区别在于谁控制这个交互.</p>
<p>以键盘和CPU之间的交互为例,如果由键盘控制交互过程,那么处理器只需要做自己的事情,当键盘数据准备好时,它会主动通知寄存器进行读取,这种就是”中断驱动”.而如果交互过程是由处理器控制,那么处理器必须不断读取,测试状态寄存器的内容,直到Ready位被置位(说明有新的字符输入),于是从寄存器中读取数据,这种就是”轮询”.</p>
<h4 id="键盘输入">键盘输入</h4>
<p>将字符从键盘输入需要两个条件:</p>
<ol type="1">
<li>数据寄存器:用来存放键盘输入字符的ASCII值,这可以通过键盘数据寄存器(KBDR,地址是0xFE02)实现,KBDR的第0~7位用来储存输入字符的ASCII码.</li>
<li>同步机制:用告诉处理器数据已经准备好的方法,这可以通过键盘状态寄存器(KBSR,地址是0xFE00)实现,KBSR的第15位用以储存同步信息(Ready位).</li>
</ol>
<p>KBSR[15]的作用是控制处理器(快速)和键盘(慢速)之间的同步.当某个按键被按下,该键对应的ASCII码被存入KBDR[7:0]的同时,键盘硬件电路自动将KBSR[15]置为1;当LC-3读取KBDR时,键盘自动清除KBSR[15].KBSR[15]=0意味着键盘可以继续输入,而KBSR[15]=1意味着上次输入的字符还没有被取走,即键盘无法继续输入其他字符.在轮询(处理器控制的I/O)方式下,程序将反复读取并测试KBSR[15]位.</p>
<p>如下程序的功能是将键盘KBDR寄存器中的ASCII值读取到本地寄存器R0中,然后跳转至下一个任务:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">START    LDI   R1,A</span><br><span class="line">         BRzp  START</span><br><span class="line">         LDI   R0,B</span><br><span class="line">         BRnzp NEXT_TASK</span><br><span class="line">A        .FILL xFE00</span><br><span class="line">B        .FILL xFE02</span><br></pre></td></tr></table></figure>
<p>解释:第一二行构成KBSR[15]的循环测试,LDI指令将地址0xFE00(0xFE00是KBSR寄存器的内存映射地址)处的值载入R1,如果KBSR[15]=0,则程序跳回START处继续循环,如果有键盘输入的话,那么该键的ASCII码被装入KBDR,同时KBSR[15]被置位,这意味着程序进入第三行代码,LDI指令将地址0xFE02(0xFE02是KBDR寄存器的内存映射地址)处的值载入R0.于是读取键盘输入过程完毕,程序无条件跳转至NEXT_TASK.</p>
<h4 id="显示器输出">显示器输出</h4>
<p>在显示器工作时:</p>
<ol type="1">
<li>输出数据寄存器是DDR,内存映射地址是0xFE06,DDR的第7~0位用来存放数据</li>
<li>状态寄存器是DSR,内存映射地址是0xFE04,DSR的第15位是Ready位</li>
</ol>
<p>DSR[15]用来同步处理器(快速)和显示器(慢速).在LC-3将单个字符的ASCII码输入到DDR[7:0]的同时,显示器硬件电路自动把DSR[15]清零(表示显示器”忙”,当前正在处理字符),然后开始DDR[7:0]的数据的处理;当显示器完成字符到屏幕的输出后,电路自动将DSR[15]置位,这表示显示器已经完成工作,处理器可以继续下一个字符的输出.</p>
<h4 id="中断驱动io">中断驱动I/O</h4>
<p>中断驱动I/O的本质是,I/O设备可以实现下列功能:</p>
<ol type="1">
<li>强行中止当前程序的运行</li>
<li>使得处理器执行I/O设备的请求</li>
<li>最后恢复中断程序的执行,并且让它感觉好像什么事情都没发生过一样</li>
</ol>
<p>中断驱动的一个优点就是,如果I/O设备采用轮询方式,处理器将会花费大量时间检测Ready位,但是采用中断方式,如果中断没有发生,处理器可以执行其他程序,当中断发生时,处理器才暂停当前程序,并自动调用相应的I/O处理程序.</p>
<p>中断驱动I/O包括两部分内容:</p>
<ol type="1">
<li>中断使能机制,即I/O设备是如何通知处理器的(当设备有输入数据,或者输出部件准备就绪时)</li>
<li>传输机制,即I/O数据是如何在处理器和设备之间传输</li>
</ol>
<p>这两部分可以简单描述为:</p>
<ol type="1">
<li>产生中断信号,中止当前执行程序</li>
<li>处理该中断请求</li>
</ol>
<p>我们这里先介绍第一部分的内容,设备是否必须,且能否中断处理器(也即第一部分内容),必须具备以下几个条件:</p>
<ol type="1">
<li>I/O设备自身确实需要服务</li>
<li>设备有请求服务的权限</li>
<li>设备中断请求的优先级高于当前处理器所运行程序的优先级</li>
</ol>
<p>如果以上三个要求都满足,则处理器才会中止当前程序,并相应设备的中断请求.</p>
<h5 id="来自设备的中断信号">来自设备的中断信号</h5>
<p>对于条件1(I/O设备自身确实需要服务),就是KBSR和DSR的寄存器Ready位,I/O设备通过设置Ready位来表示”请求服务”.</p>
<p>对于条件2(设备有请求服务的权限),是指”中断使能标志”,处理器通过设置该标志位,控制I/O设备是否有上报中断的权限.如果该标志位为1,表示处理器允许设备发送中断信号,否则,表示处理器禁止接收来自该设备的中断信号.通常状态寄存器中会包含”中断允许标志(IE)“.KBSR和DSR的第14位即为中断允许标志,来自I/O设备的中断请求信号是IE和Ready位的逻辑与(AND)结果.</p>
<h5 id="中断优先级">中断优先级</h5>
<p>对于条件3(设备中断请求的优先级高于当前处理器所运行程序的优先级),LC-3定义了<span
class="math inline">\(8\)</span>个优先级别(PL0~PL7),数值越大,对应的优先级越高.一个程序的PL通常与请求运行该程序的PL(即紧迫度)相同.如果程序当前正在运行一个特点的PL,而此时来了一个更高级别的PL计算机访问请求,那么当前这个优先级较低的程序将被挂起,直到更高级的程序完成那个请求之后,被挂起的程序才能恢复执行.中断优先级是通过优先级编码器(一个组合逻辑电路)实现的,它可以从中断信号中选出优先级最高的一个,且如果被选出的优先级比当前程序优先级高,那么则会成功生成INT中断信号,并中止当前程序.</p>
<h5 id="中断检测">中断检测</h5>
<p>指令的执行过程包括六个节拍:</p>
<p>取指令–&gt;译码–&gt;地址计算–&gt;取操作数–&gt;执行–&gt;存放结果</p>
<p>在增加了中断信号检测逻辑之后,原先的最后一步操作,即从存放结果到取指令的操作将出现变化:在存放结果的同时还会进行中断信号INT的测试.如果INT未被设置,那么一切照旧,控制单元将会直接返回取指令节拍;如果INT信号有效,则控制单元在返回取指令节拍之前,必须完成两件事情,一是保持足够的信息,以备以后可以正常恢复被中断程序的执行环境,二是将即将服务于该设备请求的程序入口地址装入PC寄存器.</p>
<h3 id="trap程序及其子程序">TRAP程序及其子程序</h3>
<h4 id="trap机制">TRAP机制</h4>
<p>TRAP机制包含以下要素:</p>
<ol type="1">
<li>服务程序集合:由操作系统提供,但以用户身份执行.这些服务程序是操作系统的组成部分,起始于各自固定的内存地址.LC-3最多可以支持256个服务程序.</li>
<li>起始地址表:包含256个服务程序的起始地址.该表位于内存地址x0000~x00FF.在不同的操作系统中,该表的名称也不一样,有的称为”系统控制块”,有的称为”陷入矢量表”.</li>
<li>TRAP指令:用户程序如果希望操作系统以用户程序身份执行某个特定的服务程序,并在执行结束后将控制权返回,则可以使用TRAP指令</li>
<li>链接:通过链接返回用户程序.它意味着操作系统所提供的从服务程序返回用户程序的机制</li>
</ol>
<h4 id="trap指令">TRAP指令</h4>
<p>在执行服务程序之前,TRAP指令需要先完成两件事:</p>
<ol type="1">
<li>根据陷入矢量表项的内容,将PC值修改为对应于服务程序的起始地址</li>
<li>提供一种机制,返回到调用TRAP指令的子程序.我们称该返回机制为链接</li>
</ol>
<p>TRAP指令由两部分组成:操作码1111和陷入矢量编号<span
class="math inline">\(\rm{bit}[7:0]\)</span>.位<span
class="math inline">\([11:8]\)</span>全部为<span
class="math inline">\(0\)</span>.陷入矢量标识了用户程序希望操作系统执行的服务程序,例如下面的陷入矢量为x23.</p>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9 8</th>
<th style="text-align: center;">7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1 1 1 1</td>
<td style="text-align: center;">0 0 0 0</td>
<td style="text-align: center;">0 0 1 0 0 0 1 1</td>
</tr>
</tbody>
</table>
<p>TRAP指令在执行时,需要完成<span
class="math inline">\(4\)</span>项任务:</p>
<ol type="1">
<li>将<span
class="math inline">\(8-\rm{bit}\)</span>的陷入矢量零扩展为<span
class="math inline">\(16-\rm{bit}\)</span>地址,并装入MAR,例如x23扩展为x0023.</li>
<li>陷入矢量表位于内存x0000~x00FF,表项x0023的内容(假设为x04A0)装入MDR</li>
<li>将当前PC值存入寄存器R7,以实现返回用户程序的链接机制</li>
<li>将MDR的内容装入PC,至此完成TRAP指令</li>
</ol>
<p>现在,PC的内容变成了x04A0,因而程序从地址x04A0开始执行.x04A0指向的是操作系统”键盘读入”程序的起始.我们说该陷入矢量指向该TRAP程序的起始.所以TRAP
x23指令的作用是激活操作系统”键盘读入”的服务程序.</p>
<p>TRAP程序能够返回用户程序的下一条指令(服务程序结束之后)的前提是,必须存在机制以保存下条指令的地址.所以TRAP指令会在服务程序加载到PC之前,先将原来的PC值存入R7.换句话说,TRAP指令为服务程序返回用户程序提供了所有必要的信息.由于在TRAP指令的预取阶段,PC已经更新,指向下一条指令,所以在TRAP服务程序<strong>开始执行时</strong>,R7中包含的是<strong>TRAP指令的下一条指令地址</strong>.</p>
<h4 id="完整机制">完整机制</h4>
<p>我们知道,若要改变程序控制流程,就要在当前指令的”执行”阶段修改PC值,之后的下一个周期,CPU将会从新地址处读取指令.</p>
<p>因而,如果要请求字符输入服务,我们只需要在用户程序中,调用TRAP指令的第x23号矢量即可.TRAP指令将从内存地址x0023读取其内容x04A0,并将其加载到PC中,同时将下一条指令的地址装入R7.在下一个指令周期的”取指令”节拍,将从x04A0开始执行,即请求键盘输入的操作系统服务程序.该TRAP服务程序的结尾是”JMP
R7”指令,其作用是将R7的内容装入PC.如果R7的内容在服务程序的执行过程中没有改变,那么该值就是用户程序中TRAP指令的下一条指令的地址.</p>
<p>在TRAP服务程序中,“JMP
R7”指令非常有用,为此LC-3汇编语言中专门为这个操作定义了一个专用指令字RET,如下:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6</th>
<th style="text-align: center;">5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1100</td>
<td style="text-align: center;">000</td>
<td style="text-align: center;">111</td>
<td style="text-align: center;">000000</td>
</tr>
</tbody>
</table>
<h4 id="halt中断程序">HALT中断程序</h4>
<p>在现代计算机中,用TRAP指令方式来清除RUN门.在LC-3中,RUN门的内容对应机器控制寄存器(映射内存地址xFFFE)的第15位.</p>
<h4 id="子程序">子程序</h4>
<p>我们称可以重复利用的代码为”子程序”或者”过程”,而C语言的属于则称之为”函数”.它们的使用机制则被称为”调用/返回机制”.</p>
<h5 id="调用返回机制">调用/返回机制</h5>
<p>调用机制的过程是,首先计算子程序的开始地址,然后装入PC,然后保持调用返回地址(下一条指令地址).在返回机制中,将把返回地址再装入Pc.</p>
<p>调用/返回机制和TRAP指令的执行过程非常相似,两种情况下,都是先保存返回调用程序的链接地址,然后将程序流跳转至代码段(服务程序或者子程序).其中,PC装入的都是代码段的起始地址,R7装入的都是返回调用者的链接地址;代码段的最后一条语句,无论是在中断服务程序还是子程序中,都是JMP
R7指令,也就是将R7的内容装入PC,从而将控制权返回到调用者.</p>
<p>子程序和服务程序之间的主要区别在于TRAP指令,在TRAP方式下,服务程序调用了操作系统资源,因而具备访问计算机底层硬件的特权.它们通常由系统程序员编写,相比之下,子程序和调用程序可以由同一个程序员编写.</p>
<h5 id="jsrjsrr指令">JSR/JSRR指令</h5>
<p>在LC-3中,子程序调用的指令的操作码是0100.该指令的寻址模式(计算子程序的起始地址)有两种:PC相对地址寻址和基地址寻址.在LC-3汇编语言中,两种模式的操作码相同,但是助记符不同.该指令完成两件事:首先将返回地址存入R7,然后将计算子程序起始地址并装入PC,返回的地址就是跳转前已经增量的PC地址,它指向调用程序中紧随JSR/JSRR指令之后的那一条指令.</p>
<p>JSR/JSRR指令由三部分组成</p>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11</th>
<th style="text-align: center;">10 9 8 7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0100</td>
<td style="text-align: center;">A</td>
<td style="text-align: center;">address evaluation bits</td>
</tr>
</tbody>
</table>
<p>其中: <span class="math inline">\(\rm{bit}[15:12]=0100\)</span>
为操作码 <span class="math inline">\(\rm{bit}[11]\)</span>
表示寻址模式,<span
class="math inline">\(1\)</span>代表PC相对寻址模式,<span
class="math inline">\(0\)</span>代表基地址寻址 <span
class="math inline">\(\rm{bit}[10:0]\)</span>
用于子程序的起始地址计算</p>
<p>JSR指令如下:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11</th>
<th style="text-align: center;">10 9 8 7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0100</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">PCoffet11</td>
</tr>
</tbody>
</table>
<p>地址计算方法是,将递增后的PC值和符号位扩展后的<span
class="math inline">\(\rm{bit}[10:0]\)</span>相加.</p>
<p>JSRR指令如下:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11</th>
<th style="text-align: center;">10 9</th>
<th style="text-align: center;">8 7 6</th>
<th style="text-align: center;">5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0100</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">00</td>
<td style="text-align: center;">BaseR</td>
<td style="text-align: center;">000000</td>
</tr>
</tbody>
</table>
<p>地址计算方法是,将递增后的PC值和基址寄存器的内容相加.</p>
<h3 id="栈">栈</h3>
<h4 id="栈的基本结构">栈的基本结构</h4>
<p>“栈”的概念,是指它的访问规则.”栈”的定义是,最后存入的东西,总是被第一个取走的,我们称这种特点为”后入先出”或”LIFO,Last
In First
Out”.按照计算机的术语来说,栈是一种<strong>抽象数据类型</strong>,抽象数据类型指的是其存储机制的操作方式(而不是实现方法).</p>
<p>下面是栈在内存中的实现</p>
<table>
<colgroup>
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
</colgroup>
<thead>
<tr>
<th style="text-align: center;">地址</th>
<th style="text-align: center;">内容</th>
<th style="text-align: center;"></th>
<th style="text-align: center;">地址</th>
<th style="text-align: center;">内容</th>
<th style="text-align: center;"></th>
<th style="text-align: center;">地址</th>
<th style="text-align: center;">内容</th>
<th style="text-align: center;"></th>
<th style="text-align: center;">地址</th>
<th style="text-align: center;">内容</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">x3FFB</td>
<td style="text-align: center;">//////</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">x3FFB</td>
<td style="text-align: center;">//////</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">x3FFB</td>
<td style="text-align: center;">//////</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">x3FFB</td>
<td style="text-align: center;">//////</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;">x3FFC</td>
<td style="text-align: center;">//////</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">x3FFC</td>
<td style="text-align: center;">//////</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">x3FFC</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">&lt;-top</td>
<td style="text-align: center;">x3FFC</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;">x3FFD</td>
<td style="text-align: center;">//////</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">x3FFD</td>
<td style="text-align: center;">//////</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">x3FFD</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">x3FFD</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;">x3FFE</td>
<td style="text-align: center;">//////</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">x3FFE</td>
<td style="text-align: center;">//////</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">x3FFE</td>
<td style="text-align: center;">31</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">x3FFE</td>
<td style="text-align: center;">31</td>
<td style="text-align: center;">&lt;-top</td>
</tr>
<tr>
<td style="text-align: center;">x3FFF</td>
<td style="text-align: center;">//////</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">x3FFF</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">&lt;-top</td>
<td style="text-align: center;">x3FFF</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">x3FFF</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">&lt;-top</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;">R6</td>
<td style="text-align: center;">x4000</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">R6</td>
<td style="text-align: center;">x3FFF</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">R6</td>
<td style="text-align: center;">x3FFC</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">R6</td>
<td style="text-align: center;">x3FFE</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;"></td>
<td style="text-align: center;">初始状态</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">压入一次</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">压入三次</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">弹出两次</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>栈是由一段连续内存空间和一个寄存器(栈指针)组成.所谓”栈指针”就是一个寄存器,里面的内容是一个地址值,<strong>始终指向栈的顶部(即最近被压入的元素)</strong>.上面的第一列代表最初的空栈,第二列压入了值<span
class="math inline">\(18\)</span>,第三列依次压入了<span
class="math inline">\(31\)</span>,<span
class="math inline">\(5\)</span>和<span
class="math inline">\(12\)</span>,最后依次弹出值<span
class="math inline">\(12\)</span>和<span
class="math inline">\(5\)</span>,其内容依旧存留在内存位置x3FFD和x3FFC处,但是这两个值不能再被访问,因为这一段内存只能通过栈机制来访问.</p>
<h5 id="压入">压入</h5>
<p>对于上面的栈的第一列,R6的内容是x4000,即基地址(x3FFF)之前的一个位置,这表明此时栈是空的.当压入<span
class="math inline">\(18\)</span>时,栈指针指向了最后压入的值,即x3FFF(储存<span
class="math inline">\(18\)</span>的位置).每压入一个值,栈指针先递减,然后将数值存入它所指向的地址位置,对应的汇编指令如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POP      ADD   R6,R6,#-1</span><br><span class="line">         STR   R0,R6,#0</span><br></pre></td></tr></table></figure>
<h5 id="弹出">弹出</h5>
<p>如果想要从栈里面弹出一个元素,要先通过指针提供的地址读取该数值,然后递增指针,对应的汇编指令如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POP      LDR   R0,R6,#0</span><br><span class="line">         ADD   R6,R6,#1</span><br></pre></td></tr></table></figure>
<p>其中栈顶的元素被弹出,装入R0.</p>
<h5 id="下溢出">下溢出</h5>
<p>如果试图对一个空栈执行弹出操作,将造成”下溢”问题.为了检查是否发生”下溢”,常用的做法是,子程序将执行成功或者失败的信息记录在某个寄存器中.在POP程序的流程中,将成功或者失败的信息记录在R5中.那么,POP程序返回后,调用程序通过R5就可以获知执行是否成功(如果成功,R5=0,否则R5=1).注意,由于POP程序使用R5记录执行情况,这就要求调用程序在JSR指令之前,保持R5的内容.对应的POP汇编指令如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POP      LD    R1,EMPTY</span><br><span class="line">         ADD   R2,R6,R1</span><br><span class="line">         BRz   Failure</span><br><span class="line">         LDR   R0,R6,#0</span><br><span class="line">         ADD   R6,R6,#1</span><br><span class="line">         AND   R5,R5,#0</span><br><span class="line">         RET</span><br><span class="line">Failure  AND   R5,R5,#0</span><br><span class="line">         ADD   R5,R5,#1</span><br><span class="line">         RET</span><br><span class="line">EMPTY    .FILL xC000</span><br></pre></td></tr></table></figure>
<p>注意RET之前的那一条指令可以影响条件码,所以调用程序也可以进行条件位Z的测试,判断POP程序是否执行成功.</p>
<h5 id="上溢出">上溢出</h5>
<p>如果在栈空间全部被占用的情况下,再往栈中压入元素,那么就会发生”上溢”问题.和”下溢”相似,通过比较栈指针内容和栈底的地址,可以判断是否发生”上溢”.如果两个值相等,则意味着栈空间已经满了.要求PUSH程序在执行成功之时,把数值<span
class="math inline">\(0\)</span>存入R5,失败时将数值<span
class="math inline">\(1\)</span>存入R5.于是,PUSH程序返回后,调用程序通过检查R5的内容,即可判断PUSH的执行是否成功.PUSH汇编指令如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUSH     LD    R1,MAX</span><br><span class="line">         ADD   R2,R6,R1</span><br><span class="line">         BRz   Failure</span><br><span class="line">         ADD   R6,R6,#-1</span><br><span class="line">         STR   R0,R6,#0</span><br><span class="line">         AND   R5,R5,#0</span><br><span class="line">         RET</span><br><span class="line">Failure  AND   R5,R5,#0</span><br><span class="line">         ADD   R5,R5,#1</span><br><span class="line">         RET</span><br><span class="line">MAX      .FILL xC005</span><br></pre></td></tr></table></figure>
<h2 id="第三部分c语言">第三部分:C语言</h2>
<h3 id="高级语言翻译">高级语言翻译</h3>
<p>高级语言有两种翻译方法:</p>
<ol type="1">
<li>解释执行,负责翻译的程序称为”解释器”,它读入高级语言程序,然后按照高级程序的语义执行相应的操作.真正的执行者不是高级语言代码本身,而是解释器程序</li>
<li>编译执行,负责翻译的程序称为”编译器”,它将高级语言程序读入,然后翻译成机器代码,又称为可执行映像,该映像是可以直接在机器上执行的.</li>
</ol>
<p>无论是解释器还是编译器,其本身也是一个程序.</p>
<h4 id="解释执行">解释执行</h4>
<p>解释器逐个读入每条命令,然后按照语言规范的语义完成命令.高级语言程序只是向解释器提供一组”数据”,而不能直接被硬件执行.换句话说,解释器如同一个虚拟机,高级语言只是在虚拟机上被执行的程序.</p>
<h4 id="编译执行">编译执行</h4>
<p>在编译执行方式中,整个高级语言被全部翻译成机器码,然后在机器上执行.为了保证程序翻译的有效性,在翻译之前,编译器会在更大的范围内做分析(通常是整个源文件).通常程序只需要编译一次,然后就可以多次执行.编译器是这样一个系统,它能处理一个或者多个包含高级语言程序的文件,生成一个”可执行映像”,编译器本身不执行程序,它只负责翻译任务,即将高级语言翻译成机器语言.</p>
<h3 id="c编程语言">C编程语言</h3>
<p>这里采用的C语言遵循ANSI C标准,只要编译器是ANSI
C兼容的,那么就可以编译这里的C语言代码.</p>
<h4 id="c编译器">C编译器</h4>
<p>C编译器能够将C源程序翻译为一个可执行映像.可执行映像是一个用机器语言表示的,具备内存装载信息的可执行程序.整个编译过程将涉及预处理器,编译器和链接器等组件.通常我们把它们统称为”编译器”.编译器在处理过程中,将自动调用预处理器和链接器等组件.</p>
<ol type="1">
<li>预处理器:C预处理器扫描所有的C源文件,寻找并执行其中的预处理指令.</li>
<li>编译器:经过预处理之后的程序,由编译器继续翻译成”目标模块”.目标模块是程序的一个组成部分,是机器语言代码形式.编译过程包括两个阶段.一是”分析”或”语法分析”,即将源程序分解为更小的组成单元;二是”合成”,即生成机器语言代码.分析阶段的任务是读入,分析源代码,并构建编译器内部格式的数据结构;而合成阶段的任务则是生成机器码,以及根据编译指令优化机器代码.符号表是编译器中一个重要的内部数据结构,它记录了程序中使用过的所有符号.</li>
<li>链接器:所有的目标代码生成后,将由链接器完成后续处理.链接器的任务是将各个目标模块组装成一个可执行映像.可执行映像是一种具有特定格式的机器语言程序,具有可装载性和可直接执行这两个特性.C程序对于库函数的依赖非常强.库函数中包含了最常用的一些操作函数,它们以库函数的方式存在.这些库函数通常由系统软件(如操作系统,编译器)的开发者编写.在用户程序中,如果调用了库函数,则链接器将负责查找该函数在库文件中的位置,并拷贝对应目标代码,然后”链接”入可执行映像.</li>
</ol>
<h3 id="变量和运算符">变量和运算符</h3>
<h4 id="变量">变量</h4>
<h5
id="三种基本数据类型intchardouble">三种基本数据类型:int,char,double</h5>
<ol type="1">
<li>int:标识符int声明的是一个有符号整数变量.整数类型的内部表示及其数值大小的范围,取决于不同的ISA以及所使用的编译器.一般情况下,C语言的int和底层的ISA的字长相对应.</li>
<li>char:标识符int声明的是一个字符类型的数据.</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> key=<span class="string">&#x27;Q&#x27;</span></span><br></pre></td></tr></table></figure>
<p>这里变量<code>key</code>的初始值是大写字母<code>Q</code>的ASCII码值.注意<code>Q</code>被单引号包围,表明这是一个ASCII字符值.</p>
<ol start="3" type="1">
<li>double: 标识符double声明的是一个浮点类型变量.</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> a = <span class="number">2.1E2</span>; <span class="comment">/*这是210.0*/</span></span><br><span class="line"><span class="type">double</span> b = <span class="number">-2E-1</span>; <span class="comment">/*这是-0.2*/</span></span><br></pre></td></tr></table></figure>
<h5 id="局部变量和全局变量">局部变量和全局变量</h5>
<p>在C语言中,程序中的变量声明是向编译器传递以下三类信息:变量的标识符,类型,作用域.对于前两者,编译器可以直接从变量声明语句中获取,但是有关作用域,编译器则要通过声明语句所在位置判断.</p>
<ol type="1">
<li>局部变量:有些变量是在它们所在代码块的开始处声明,我们称为局部变量.这里所说的代码块指的是用一对大括号包括起来的代码.局部变量只能在当前代码块中被访问.</li>
<li>全局变量:全局变量在整个程序的生命周期内都占有独立的空间及其内容,可以在程序的任意地方被访问.</li>
</ol>
<h4 id="运算符">运算符</h4>
<h5 id="赋值运算符">赋值运算符</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = b + c;</span><br><span class="line">x = x + <span class="number">4</span>;</span><br><span class="line">x = x + <span class="number">4.0</span>;  </span><br></pre></td></tr></table></figure>
<h5 id="算数运算符">算数运算符</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x + y;</span><br><span class="line">x - y;</span><br><span class="line">x * y;</span><br><span class="line">x / y;</span><br><span class="line">x % y; <span class="comment">/*取余数*/</span></span><br></pre></td></tr></table></figure>
<h5 id="位运算符">位运算符</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x1234</span> &amp; <span class="number">0x5678</span>;  <span class="comment">/*按位与，等于0x567C*/</span></span><br><span class="line"><span class="number">0x1234</span> | <span class="number">0x5678</span>;  <span class="comment">/*按位或，等于0x1230*/</span></span><br><span class="line"><span class="number">0x1234</span> ^ <span class="number">0x5678</span>;  <span class="comment">/*按位异或，等于0x444C*/</span></span><br><span class="line">~<span class="number">0x1234</span>;          <span class="comment">/*按位取反，等于0xEDCB*/</span></span><br><span class="line"><span class="number">1234</span> &amp; <span class="number">5678</span>;      <span class="comment">/*按位与，等于1026*/</span></span><br><span class="line"><span class="number">0x1234</span> &lt;&lt; <span class="number">3</span>;      <span class="comment">/*左移3位，右边补0，等于0x91A0*/</span></span><br><span class="line"><span class="number">0x1234</span> &gt;&gt; <span class="number">2</span>;      <span class="comment">/*右移2位，左边符号扩展，等于0x048D*/</span></span><br><span class="line"><span class="number">1234</span> &lt;&lt; <span class="number">3</span>;        <span class="comment">/*等于9872*/</span></span><br><span class="line"><span class="number">1234</span> &gt;&gt; <span class="number">2</span>;        <span class="comment">/*等于308*/</span></span><br></pre></td></tr></table></figure>
<h5 id="关系运算符">关系运算符</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;,&lt;,&lt;=,&gt;=,==,!=;</span><br></pre></td></tr></table></figure>
<h5 id="逻辑运算符">逻辑运算符</h5>
<p>在C语言中,任何非零值都是逻辑真,数值零被认为逻辑假.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">!        <span class="comment">/*逻辑非*/</span></span><br><span class="line">&amp;&amp;       <span class="comment">/*逻辑与*/</span></span><br><span class="line">||       <span class="comment">/*逻辑或*/</span></span><br></pre></td></tr></table></figure>
<h5 id="递增递减运算符">递增/递减运算符</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y = x++;    <span class="comment">/*先把x赋给y，然后自增*/</span></span><br><span class="line">y = ++x;    <span class="comment">/*x先自增，然后把新的值赋给y*/</span></span><br></pre></td></tr></table></figure>
<h4 id="编译器处理">编译器处理</h4>
<p>编译器在完成翻译工作的时候,需要借助于两个机制:</p>
<ol type="1">
<li>符号表:编译器在编译过程中,将与变量相关的信息记录在”符号表”中.</li>
<li>内存的系统分配:根据变量特性分配内存.编译器将从整个系统层面,为不同类别的对象划分不同的内存区域.</li>
</ol>
<p>我们看一个例子:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="type">int</span> amount;</span><br><span class="line">   <span class="type">int</span> rate;</span><br><span class="line">   <span class="type">int</span> time;</span><br><span class="line"></span><br><span class="line">   <span class="type">int</span> hours;</span><br><span class="line">   <span class="type">int</span> minutes;</span><br><span class="line">   <span class="type">int</span> seconds;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;How many bytes of data to be transferred?&quot;</span>);</span><br><span class="line">   <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;amount);</span><br><span class="line"></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;What is the transfer rate?&quot;</span>)</span><br><span class="line">   <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;rate)</span><br><span class="line"></span><br><span class="line">   time = amount / rate;</span><br><span class="line"></span><br><span class="line">   hours = time / <span class="number">3600</span>;</span><br><span class="line">   minutes = (time % <span class="number">3600</span>) /<span class="number">60</span>;</span><br><span class="line">   seconds = ((time % <span class="number">3600</span>) % <span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;Time: %dh %dm %ds\n&quot;</span>, hours, minutes, seconds);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="符号表">符号表</h5>
<p>编译器在扫描程序代码时,每遇到一个变量声明语句,就在符号表中创造一个新的表项.表项结构中包含很多字段信息,这些字段信息与变量的存储空间管理以及变量操作代码生成等都有关.这些字段包括:名字,类型,已分配的内存地址,变量声明域或作用域等信息.</p>
<p>下面的符号表对应上面的代码.注意,编译器采用偏移方式记录变量在内存中的位置.</p>
<table>
<thead>
<tr>
<th style="text-align: center;">标识</th>
<th style="text-align: center;">类型</th>
<th style="text-align: center;">位置(偏移量)</th>
<th style="text-align: center;">范围</th>
<th style="text-align: center;">其他信息</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">amount</td>
<td style="text-align: center;">int</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">main</td>
<td style="text-align: center;">…</td>
</tr>
<tr>
<td style="text-align: center;">hours</td>
<td style="text-align: center;">int</td>
<td style="text-align: center;">-3</td>
<td style="text-align: center;">main</td>
<td style="text-align: center;">…</td>
</tr>
<tr>
<td style="text-align: center;">minutes</td>
<td style="text-align: center;">int</td>
<td style="text-align: center;">-4</td>
<td style="text-align: center;">main</td>
<td style="text-align: center;">…</td>
</tr>
<tr>
<td style="text-align: center;">rate</td>
<td style="text-align: center;">int</td>
<td style="text-align: center;">-1</td>
<td style="text-align: center;">main</td>
<td style="text-align: center;">…</td>
</tr>
<tr>
<td style="text-align: center;">seconds</td>
<td style="text-align: center;">int</td>
<td style="text-align: center;">-5</td>
<td style="text-align: center;">main</td>
<td style="text-align: center;">…</td>
</tr>
<tr>
<td style="text-align: center;">time</td>
<td style="text-align: center;">int</td>
<td style="text-align: center;">-2</td>
<td style="text-align: center;">main</td>
<td style="text-align: center;">…</td>
</tr>
</tbody>
</table>
<h5 id="变量的空间分配">变量的空间分配</h5>
<p>在C语言中,存放变量内容的内存空间(变量的分配空间)有两种区段:<strong>全局数据段</strong>和<strong>运行时栈</strong>.全局数据段是内存中存放全局变量的区段,运行时栈是局部变量所在的地方.符号表中的偏移字段提供了有关变量在内存中的更精确的位置信息,它代表的是变量存储地址距离内存段基地址的偏移(或距离).</p>
<p>在编译器生成的机器代码中,R4是一个专用寄存器,它存放的是全局数据段的基地址(或起始地址),所以R4可以被视为是全局指针.而一个函数中所有的局部变量都存放在一个被称为<strong>活动记录</strong>或者<strong>堆栈帧</strong>的内存模板中.所谓的活动记录,就是一段连续的内存空间,它包含了当前函数中所有的局部变量.每个函数都有自己的活动记录.当我们调用一个函数时,该函数活动记录的最大地址将存放在寄存器R5中,因此R5又被称为<strong>帧指针</strong>.</p>
<p>当我们调用一个函数时,该函数的活动记录被压入当前栈.同时R5的内容被调整,指向当前栈顶(即记录的基地址).这表明可以通过栈指针访问函数内的局部变量.当该函数结束,即将把控制权交还给调用者时,活动记录将被弹出当前栈.同样,指针R5的内容也会被修改,指向调用者活动记录所在位置.整个过程中,寄存器R6始终指向运行时栈顶,我们称R6为<strong>栈指针</strong>.</p>
<h3 id="控制结构">控制结构</h3>
<p>一个大问题被分解成多个子任务,然后对每个子任务独立编程.各种子任务的基本编程结构可以分为顺序,条件和循环.</p>
<h4 id="条件结构">条件结构</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (x &lt;= <span class="number">10</span>)</span><br><span class="line">   y= x^<span class="number">2</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (x &lt;= <span class="number">10</span>)&#123;</span><br><span class="line">   y= x^<span class="number">2</span> + <span class="number">5</span>;</span><br><span class="line">   z= <span class="number">2</span>*y - <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (x)&#123;</span><br><span class="line">   y++;</span><br><span class="line">   z--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">   y--;</span><br><span class="line">   z++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="type">int</span> month;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;Enter the number of the month:&quot;</span>);</span><br><span class="line">   <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;month);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(month==<span class="number">4</span> || month==<span class="number">6</span> || month==<span class="number">9</span> || month==<span class="number">11</span>)</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;The month has 30 days\n&quot;</span>);</span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span>(month==<span class="number">1</span> || month==<span class="number">3</span> || month==<span class="number">5</span> || month==<span class="number">7</span> || month==<span class="number">8</span> || month==<span class="number">10</span> || month==<span class="number">12</span>)</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;The month has 31 days\n&quot;</span>);</span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span>(month==<span class="number">2</span>)</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;The month has either 29 days or 28 days\n&quot;</span>);</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Don&#x27;t know that month.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="循环结构">循环结构</h4>
<h5 id="while语句">while语句</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="type">int</span> x = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">while</span> (x &lt; <span class="number">10</span>)&#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">      x = x + <span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="for语句">for语句</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="type">int</span> multiplicand;</span><br><span class="line">   <span class="type">int</span> multiplier;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span>(multiplicant=<span class="number">0</span>; multiplicant&lt;<span class="number">10</span>; multiplicant++)&#123;</span><br><span class="line">      <span class="keyword">for</span>(multiplier=<span class="number">0</span>; multiplier&lt;<span class="number">10</span>; multiplier++)&#123;</span><br><span class="line">         <span class="built_in">printf</span>(<span class="string">&quot;%d\t&quot;</span>, multiplier*multiplicant);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="do-while循环">do-while循环</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%d \n&quot;</span>, x);</span><br><span class="line">   x = x + <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> (x &lt; <span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<h4 id="其他控制结构">其他控制结构</h4>
<h5 id="switch语句">switch语句</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> keypress;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span>(keypress)&#123;</span><br><span class="line">   <span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">   <span class="comment">/*statement A*/</span></span><br><span class="line">   <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">case</span> <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">   <span class="comment">/*statement B*/</span></span><br><span class="line">   <span class="keyword">break</span>;   </span><br><span class="line"></span><br><span class="line">   <span class="keyword">case</span> <span class="string">&#x27;c&#x27;</span>:</span><br><span class="line">   <span class="comment">/*statement C*/</span></span><br><span class="line">   <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">   <span class="comment">/*statement D*/</span></span><br><span class="line">   <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="break和continue语句">break和continue语句</h5>
<p><code>break</code>的作用是立即结束其所在的循环体.<code>continue</code>的作用是,立即跳转至下一次循环.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++)&#123;</span><br><span class="line">   <span class="keyword">if</span>(i==<span class="number">5</span>)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, i);</span><br><span class="line">&#125;<span class="comment">/*output:0 1 2 3 4*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++)&#123;</span><br><span class="line">   <span class="keyword">if</span>(i==<span class="number">5</span>)</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, i);</span><br><span class="line">&#125;<span class="comment">/*output:0 1 2 3 4 6 7 8 9*/</span></span><br></pre></td></tr></table></figure>
<h3 id="函数">函数</h3>
<h4 id="c语言中的函数">C语言中的函数</h4>
<h5 id="声明">声明</h5>
<p>函数声明告诉编译器函数的一些相关属性,我们又称之为”函数原型”.函数声明的内容包括:函数名,返回值类型以及输入参数列表.函数声明语句以分号结尾.</p>
<ol type="1">
<li>函数返回值类型是声明语句的第一个字段.该类型可以说int,char,double等,它描述了函数将产生的输出结果(唯一的).但是不是所有函数都有返回值,如果没有返回值,那么就称它的返回类型是void.</li>
<li>第二个字段是函数名.</li>
<li>第三个字段描述了函数所需的输入参数的类型和顺序,它们是该函数期望从调用者获取的参数类型和传入顺序.</li>
</ol>
<h5 id="调用">调用</h5>
<p>调用是只需提供函数名和对应的输入参数,注意输入参数的类型要与声明中的类型相匹配.</p>
<h5 id="定义">定义</h5>
<p>函数定义和函数声明几乎一样,除了前者后面不需要分号.函数名后面是函数的正则化参数列表,所谓正则化参数列表就是一组变量的声明,每个变量的内容都被初始化为调用者提供的对应数值.调用者传递的形式参数必须和正则化参数列表中定义的参数类型和顺序相匹配.</p>
<h5 id="返回">返回</h5>
<p>如果函数要返回一个值,那么关键词<code>return</code>必须跟随一个表达式,且该表达式的类型必须与函数声明的返回值类型相匹配.而没有返回值的函数(声明为<code>void</code>的函数),不需要<code>return</code>语句.</p>
<h4 id="c语言函数的实现">C语言函数的实现</h4>
<h2 id="附录-lc-3指令集结构">附录 LC-3指令集结构</h2>
<h3 id="概述">概述</h3>
<ul>
<li>内存地址空间:16位地址,对应<span
class="math inline">\(2^{16}\)</span>个内存单元,每个单元包含一个字,每个字宽度是<span
class="math inline">\(16\)</span>位.地址的编号从x0000到xFFFF,地址是用来识别每个内存单元和内存映射的I/O设备寄存器.内存中的部分区段有特殊用途,划分如下:
<ol type="1">
<li>x0000~x00FF:陷入矢量表</li>
<li>x0100~x01FF:中断矢量表</li>
<li>x0200~x2FFF:操作系统及其内核栈空间</li>
<li>x3000~xFDFF:用户程序占用空间</li>
<li>xFE00~xFFFF:设备寄存器地址空间</li>
</ol></li>
<li>位编号:量化数的每个位也是有编号的.通常,最右边的位是<span
class="math inline">\(\rm{bit}[0]\)</span>,最左边的位是<span
class="math inline">\(\rm{bit}[15]\)</span>.</li>
<li>指令:每个指令的宽度是<span
class="math inline">\(16\)</span>位,前四位(<span
class="math inline">\(\rm{bit}[15:12]\)</span>)是操作码.</li>
<li>非法操作码异常:操作码<span
class="math inline">\(\rm{bit}[15:12]=1101\)</span>是没有定义的.</li>
<li>程序计数器:<span
class="math inline">\(16~\rm{bit}\)</span>宽度的一个寄存器,内容是下一条执行指令所在的地址.</li>
<li>通用寄存器:<span
class="math inline">\(16~\rm{bit}\)</span>宽度的八个寄存器,编号从<span
class="math inline">\(000\)</span>到<span
class="math inline">\(111\)</span>.</li>
<li>条件码:<span
class="math inline">\(1~\rm{bit}\)</span>宽度的三个寄存器,分别是N,Z,P.Load类型的指令和运算指令在向任意一个通用寄存器中写入内容时,都会改变条件码.而其他的指令不会改变条件码.</li>
<li>内存映射:设备的输入输出是通过Load和Store指令完成的,所以需要为I/O设备寄存器分配内存地址(xFE00~xFFFF).</li>
<li>中断处理</li>
<li>优先级:LC-3定义了<span
class="math inline">\(8\)</span>个优先级,其中PL7最高,PL0最低.</li>
<li>处理器状态寄存器:<span
class="math inline">\(16~\rm{bit}\)</span>宽度的寄存器,包含了当前执行进程的状态信息.其中PSR的<span
class="math inline">\(8\)</span>个位已经做了定义,PSR[15]定义了执行进程的权限模式,PSR[10:8]表示当前执行进程的优先级别,PSR[2:0]包含的是条件码(PSR[2]=N,PSR[1]=Z,PSR[0]=P).</li>
<li>权限模式:LC-3定义了两种权限模式,特权模式和用户模式.PSR[15]=0表示特权模式,PSR[15]=1表示用户模式.</li>
<li>权限模式异常:如果RTI指令执行在特权模式下,但是你试图在用户模式下执行RTI指令,那么会产生”权限模式异常”</li>
<li>特权模式栈空间:又称为内核栈空间.在特权模式下,通过SSP指针访问该内存区域.事实上,特权模式PSR[15]=0下,栈指针R6就是SSP</li>
<li>用户模式栈空间:在用户模式下,通过USP指针访问该内存区域.事实上,特权模式PSR[15]=1下,栈指针R6就是USP</li>
</ul>
<h3 id="lc-3指令集详解">LC-3指令集详解</h3>
<h4 id="add">ADD</h4>
<p>汇编器格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ADD DR,SR1,SR2</span><br><span class="line">ADD DR,SR1,imm5</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">4 3</th>
<th style="text-align: center;">2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0001</td>
<td style="text-align: center;">DR</td>
<td style="text-align: center;">SR1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">00</td>
<td style="text-align: center;">SR2</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0001</td>
<td style="text-align: center;">DR</td>
<td style="text-align: center;">SR1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">imm5</td>
</tr>
</tbody>
</table>
<p>操作说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (bit[<span class="number">5</span>]==<span class="number">0</span>)</span><br><span class="line">   DR=SR1+SR2;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   DR=SR1+SEXT(imm5);</span><br><span class="line">setcc()</span><br></pre></td></tr></table></figure>
<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ADD R2,R3,R4      ;R2&lt;-R3+R4</span><br><span class="line">ADD R2,R3,#7      ;R2&lt;-R3+7</span><br></pre></td></tr></table></figure>
<h4 id="and">AND</h4>
<p>汇编器格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AND DR,SR1,SR2</span><br><span class="line">AND DR,SR1,imm5</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">4 3</th>
<th style="text-align: center;">2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0101</td>
<td style="text-align: center;">DR</td>
<td style="text-align: center;">SR1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">00</td>
<td style="text-align: center;">SR2</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0101</td>
<td style="text-align: center;">DR</td>
<td style="text-align: center;">SR1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">imm5</td>
</tr>
</tbody>
</table>
<p>操作说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (bit[<span class="number">5</span>]==<span class="number">0</span>)</span><br><span class="line">   DR=SR1 AND SR2;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   DR=SR1 ANd SEXT(imm5);</span><br><span class="line">setcc()</span><br></pre></td></tr></table></figure>
<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AND R2,R3,R4      ;R2&lt;-R3 AND R4</span><br><span class="line">AND R2,R3,#7      ;R2&lt;-R3 AND 7</span><br></pre></td></tr></table></figure>
<h4 id="br">BR</h4>
<p>汇编器格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BR  LABEL   BRnzp LABEL</span><br><span class="line">BRn LABEL   BRzp  LABEL</span><br><span class="line">BRz LABEL   BRnp  LABEL</span><br><span class="line">BRp LABEL   BRnz  LABEL</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11</th>
<th style="text-align: center;">10</th>
<th style="text-align: center;">9</th>
<th style="text-align: center;">8 7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0000</td>
<td style="text-align: center;">n</td>
<td style="text-align: center;">z</td>
<td style="text-align: center;">p</td>
<td style="text-align: center;">PCoffset9</td>
</tr>
</tbody>
</table>
<p>操作说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((n AND N) OR (z AND Z) OR (p AND P))</span><br><span class="line">   PC=(PC+<span class="number">1</span>)+SEXT(PCoffset9)</span><br></pre></td></tr></table></figure>
<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BRzp LOOP      ;如果最后的结果是零或者正数,那么跳转至LOOP</span><br><span class="line">BR   NEXT      ;无条件跳转至NEXT</span><br></pre></td></tr></table></figure>
<h4 id="jmp和ret">JMP和RET</h4>
<p>汇编器格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JMP   BaseR</span><br><span class="line">RET</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6</th>
<th style="text-align: center;">5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1100</td>
<td style="text-align: center;">000</td>
<td style="text-align: center;">BaseR</td>
<td style="text-align: center;">000000</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6</th>
<th style="text-align: center;">5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1100</td>
<td style="text-align: center;">000</td>
<td style="text-align: center;">111</td>
<td style="text-align: center;">000000</td>
</tr>
</tbody>
</table>
<p>操作说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PC=BaseR</span><br></pre></td></tr></table></figure>
<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JMP   R2    ;PC&lt;-R2</span><br><span class="line">RET         ;PC&lt;-R7</span><br></pre></td></tr></table></figure>
<p>注意:RET指令可以看作JMP指令的一个特例,PC被装入R7的内容,R7扮演的是链接的作用,其内容指向子程序调用指令之后的指令地址.</p>
<h3 id="jsr和jsrr">JSR和JSRR</h3>
<p>汇编器格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JSR   LABEL</span><br><span class="line">JSRR  BaseR</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11</th>
<th style="text-align: center;">10 9 8 7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0100</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">PCoffet11</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11</th>
<th style="text-align: center;">10 9</th>
<th style="text-align: center;">8 7 6</th>
<th style="text-align: center;">5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0100</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">00</td>
<td style="text-align: center;">BaseR</td>
<td style="text-align: center;">000000</td>
</tr>
</tbody>
</table>
<p>操作说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">R7=PC+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (bit[<span class="number">11</span>]==<span class="number">0</span>)</span><br><span class="line">   PC=BaseR;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   PC=PC+SEXT(PCoffset11);</span><br></pre></td></tr></table></figure>
<p>解释:增量PC值先保存在R7中,这是返回调用代码的链接地址,然后PC装入被调用子程序的入口地址,即等价于无条件跳转至该地址.子程序的入口地址来自基址寄存器或者是PC增量和偏移量的符号扩展之和.</p>
<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JSR   QUEUE    ;将JSR指令之后的地址装入R7,然后跳转至QUEUE</span><br><span class="line">JSRR  R3       ;将JSRR指令之后的地址装入R7,然后跳转至R3内容所指定的地址</span><br></pre></td></tr></table></figure>
<h3 id="load系列指令">Load系列指令</h3>
<h4 id="ld">LD</h4>
<p>汇编器格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD DR,LABEL</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0010</td>
<td style="text-align: center;">DR</td>
<td style="text-align: center;">PCoffet9</td>
</tr>
</tbody>
</table>
<p>操作说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DR=mem((PC+<span class="number">1</span>)+SEXT(PCoffset9));</span><br><span class="line">setcc();</span><br></pre></td></tr></table></figure>
<p>解释:将PC增量和偏移量的符号扩展相加,计算出一个地址,然后将这个地址的内存单元的内容装入DR寄存器,同时设置条件码.</p>
<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD  R4,VALUE      ;R4&lt;-mem[VALUE]</span><br></pre></td></tr></table></figure>
<h4 id="ldi">LDI</h4>
<p>汇编器格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LDI DR,LABEL</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1010</td>
<td style="text-align: center;">DR</td>
<td style="text-align: center;">PCoffet9</td>
</tr>
</tbody>
</table>
<p>操作说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DR=mem[mem((PC+<span class="number">1</span>)+SEXT(PCoffset9))];</span><br><span class="line">setcc();</span><br></pre></td></tr></table></figure>
<p>解释:将PC增量和偏移量的符号扩展相加,计算出一个地址,然后将这个地址的内存单元的内容作为地址,再次读取内存,将其对应地址中的内容装入DR寄存器,同时设置条件码.</p>
<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LDI  R4,ONEMORE      ;R4&lt;-mem[mem[ONEMORE]]</span><br></pre></td></tr></table></figure>
<h4 id="ldr">LDR</h4>
<p>汇编器格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LDR DR,BaseR,offset6</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6</th>
<th style="text-align: center;">5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0110</td>
<td style="text-align: center;">DR</td>
<td style="text-align: center;">BaseR</td>
<td style="text-align: center;">PCoffet6</td>
</tr>
</tbody>
</table>
<p>操作说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DR=mem[BaseR+SEXT(offset6)];</span><br><span class="line">setcc();</span><br></pre></td></tr></table></figure>
<p>解释:将指定寄存器的内容和偏移量的符号扩展相加,计算出一个地址,然后将这个地址的内存单元的内容装入DR寄存器,同时设置条件码.</p>
<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LDR  R4,R2,#-5    ;R4&lt;-mem[R2-5]</span><br></pre></td></tr></table></figure>
<h4 id="lea">LEA</h4>
<p>汇编器格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LEA DR,LABEL</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1110</td>
<td style="text-align: center;">DR</td>
<td style="text-align: center;">PCoffet9</td>
</tr>
</tbody>
</table>
<p>操作说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DR=(PC+<span class="number">1</span>)+SEXT(PCoffset9);</span><br><span class="line">setcc();</span><br></pre></td></tr></table></figure>
<p>解释:将PC增量和偏移量的符号扩展相加,计算出一个地址,然后将这个地址直接装入DR寄存器(无需访问内存,只是将计算出来的内存单元的地址放入DR中),同时设置条件码.</p>
<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LEA  R4,TERTGET    ;R4&lt;-address of TARTGET</span><br></pre></td></tr></table></figure>
<h3 id="not">NOT</h3>
<p>汇编器格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NOT DR,SR</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6</th>
<th style="text-align: center;">5</th>
<th style="text-align: center;">4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1001</td>
<td style="text-align: center;">DR</td>
<td style="text-align: center;">SR</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">11111</td>
</tr>
</tbody>
</table>
<p>操作说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DR=NOT(SR);</span><br><span class="line">setcc();</span><br></pre></td></tr></table></figure>
<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NOT R4,R2    ;R4&lt;-NOT(R2)</span><br></pre></td></tr></table></figure>
<h3 id="rti">RTI</h3>
<p>汇编器格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RTI</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9 8 7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1000</td>
<td style="text-align: center;">000000000000</td>
</tr>
</tbody>
</table>
<p>操作说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (PSR[<span class="number">15</span>]==<span class="number">0</span>)</span><br><span class="line">   PC=mem[R6];    <span class="comment">//R6是SSP</span></span><br><span class="line">   R6=R6+<span class="number">1</span>;</span><br><span class="line">   TEMP=mem[R6];</span><br><span class="line">   R6=R6+<span class="number">1</span>;</span><br><span class="line">   PSR=TEMP;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>解释:如果当前处理器运行在特权模式,则该指令是合法的,特权模式栈顶部两个单元的内容被弹出,并分别赋值给PC和PSR.如果当前处理器运行在用户模式,则该指令的执行将引发”特权模式冲突”异常.</p>
<h3 id="store系列指令">Store系列指令</h3>
<h4 id="st">ST</h4>
<p>汇编器格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ST SR,LABEL</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6</th>
<th style="text-align: center;">5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0111</td>
<td style="text-align: center;">SR</td>
<td style="text-align: center;">BaseR</td>
<td style="text-align: center;">offset6</td>
</tr>
</tbody>
</table>
<p>操作说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mem[(PC+<span class="number">1</span>)+SEXT(PCoffset9)]=SR;</span><br></pre></td></tr></table></figure>
<p>解释:将PC增量和偏移量的符号扩展相加,计算出一个地址,然后将SR的内容装入改地址指向的内存单元中.</p>
<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ST    R4,HERE     ;mem[HERE]&lt;-R4</span><br></pre></td></tr></table></figure>
<h4 id="sti">STI</h4>
<p>汇编器格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STI SR,LABEL</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1011</td>
<td style="text-align: center;">SR</td>
<td style="text-align: center;">PCoffet9</td>
</tr>
</tbody>
</table>
<p>操作说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mem[mem((PC+<span class="number">1</span>)+SEXT(PCoffset9))]=SR;</span><br></pre></td></tr></table></figure>
<p>解释:将PC增量和偏移量的符号扩展相加,计算出一个地址,然后将这个地址的内存单元的内容作为地址,再次读取内存,将SR的内容装入这个地址中.</p>
<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STI   R4,NOT_HERE      ;mem[mem[NOT_HERE]]&lt;-R4</span><br></pre></td></tr></table></figure>
<h4 id="str">STR</h4>
<p>汇编器格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STR   SR,BaseR,offset6</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9</th>
<th style="text-align: center;">8 7 6</th>
<th style="text-align: center;">5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0111</td>
<td style="text-align: center;">SR</td>
<td style="text-align: center;">BaseR</td>
<td style="text-align: center;">offet6</td>
</tr>
</tbody>
</table>
<p>操作说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mem[BaseR+SEXT(offset6)]=SR;</span><br></pre></td></tr></table></figure>
<p>解释:将指定寄存器的内容和偏移量的符号扩展相加,计算出一个地址,然后将SR的内容装入该地址指向的内存单元中.</p>
<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STR   R4,R2,#5   ;mem[R2+5]&lt;-R4</span><br></pre></td></tr></table></figure>
<h3 id="trap-1">TRAP</h3>
<p>汇编器格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRAP  trapvector8</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align: center;">15 14 13 12</th>
<th style="text-align: center;">11 10 9 8</th>
<th style="text-align: center;">7 6 5 4 3 2 1 0</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1111</td>
<td style="text-align: center;">0000</td>
<td style="text-align: center;">trapvect8</td>
</tr>
</tbody>
</table>
<p>操作说明</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">R7=PC+<span class="number">1</span>;</span><br><span class="line">PC=mem[ZEXT(trapvect8)];</span><br></pre></td></tr></table></figure>
<p>解释:首先将PC增量装入R7(为服务返回程序做准备).然后将由trapvector8指定的系统调用的入口地址装入PC(等价于跳转).注意,这个入口地址的计算是间接的,即先将trapvector8零扩展为一个<span
class="math inline">\(16~\rm{bit}\)</span>地址,然后读取该地址单元的内容,作为服务程序的入口地址.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">SiyuanLei</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
